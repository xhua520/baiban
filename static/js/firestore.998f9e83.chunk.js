/*! For license information please see firestore.998f9e83.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkexcalidraw=self.webpackChunkexcalidraw||[]).push([[1965],{341:function(t,e,n){n.r(e);var r=n(6740),i=n(2293),o=n(9386),s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},s(t,e)};function a(t){var e="function"===typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"===typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var u,c="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},h=h||{},l=c||self;function f(){}function d(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function p(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var y="closure_uid_"+(1e9*Math.random()>>>0),v=0;function m(t,e,n){return t.call.apply(t.bind,arguments)}function g(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function b(t,e,n){return(b=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?m:g).apply(null,arguments)}function w(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function I(){return Date.now()}function T(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Kb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function _(){this.j=this.j,this.i=this.i}_.prototype.j=!1,_.prototype.ja=function(){if(!this.j&&(this.j=!0,this.G(),0))(function(t){Object.prototype.hasOwnProperty.call(t,y)&&t[y]||(t[y]=++v)})(this)},_.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var E=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"===typeof t)return"string"!==typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},S=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"===typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function A(t){return Array.prototype.concat.apply([],arguments)}function D(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function N(t){return/^[\s\xa0]*$/.test(t)}var C,k=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function x(t,e){return-1!=t.indexOf(e)}function R(t,e){return t<e?-1:t>e?1:0}t:{var O=l.navigator;if(O){var P=O.userAgent;if(P){C=P;break t}}C=""}function L(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function M(t){var e={};for(var n in t)e[n]=t[n];return e}var F="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function V(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<F.length;o++)n=F[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function U(t){return U[" "](t),t}U[" "]=f;var q,B=x(C,"Opera"),j=x(C,"Trident")||x(C,"MSIE"),K=x(C,"Edge"),G=K||j,z=x(C,"Gecko")&&!(x(C.toLowerCase(),"webkit")&&!x(C,"Edge"))&&!(x(C,"Trident")||x(C,"MSIE"))&&!x(C,"Edge"),Q=x(C.toLowerCase(),"webkit")&&!x(C,"Edge");function H(){var t=l.document;return t?t.documentMode:void 0}t:{var W="",Y=function(){var t=C;return z?/rv:([^\);]+)(\)|;)/.exec(t):K?/Edge\/([\d\.]+)/.exec(t):j?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t):Q?/WebKit\/(\S+)/.exec(t):B?/(?:Version)[ \/]?(\S+)/.exec(t):void 0}();if(Y&&(W=Y?Y[1]:""),j){var X=H();if(null!=X&&X>parseFloat(W)){q=String(X);break t}}q=W}var $,J={};function Z(t){return function(t,e){var n=J;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,(function(){for(var e=0,n=k(String(q)).split("."),r=k(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=R(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||R(0==s[2].length,0==a[2].length)||R(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e}))}if(l.document&&j){var tt=H();$=tt||(parseInt(q,10)||void 0)}else $=void 0;var et=$,nt=!j||9<=Number(et),rt=j&&!Z("9"),it=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{l.addEventListener("test",f,e),l.removeEventListener("test",f,e)}catch(n){}return t}();function ot(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function st(t,e){if(ot.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(z){t:{try{U(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"===typeof t.pointerType?t.pointerType:at[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}ot.prototype.b=function(){this.defaultPrevented=!0},T(st,ot);var at={2:"touch",3:"pen",4:"mouse"};st.prototype.b=function(){st.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,rt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(e){}};var ut="closure_listenable_"+(1e6*Math.random()|0),ct=0;function ht(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++ct,this.Y=this.Z=!1}function lt(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function ft(t){this.src=t,this.a={},this.b=0}function dt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=E(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(lt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function pt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}ft.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=pt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new ht(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var yt="closure_lm_"+(1e6*Math.random()|0),vt={};function mt(t,e,n,r,i){if(r&&r.once)return bt(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)mt(t,e[o],n,r,i);return null}return n=Dt(n),t&&t[ut]?t.va(e,n,p(r)?!!r.capture:!!r,i):gt(t,e,n,!1,r,i)}function gt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=p(i)?!!i.capture:!!i;if(s&&!nt)return null;var a=St(t);if(a||(t[yt]=a=new ft(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Et,e=nt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)it||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Tt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function bt(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)bt(t,e[o],n,r,i);return null}return n=Dt(n),t&&t[ut]?t.wa(e,n,p(r)?!!r.capture:!!r,i):gt(t,e,n,!0,r,i)}function wt(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)wt(t,e[o],n,r,i);else r=p(r)?!!r.capture:!!r,n=Dt(n),t&&t[ut]?(t=t.c,(e=String(e).toString())in t.a&&(-1<(n=pt(o=t.a[e],n,r,i))&&(lt(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):t&&(t=St(t))&&(e=t.a[e.toString()],t=-1,e&&(t=pt(e,n,r,i)),(n=-1<t?e[t]:null)&&It(n))}function It(t){if("number"!==typeof t&&t&&!t.Y){var e=t.src;if(e&&e[ut])dt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Tt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=St(e))?(dt(n,t),0==n.b&&(n.src=null,e[yt]=null)):lt(t)}}}function Tt(t){return t in vt?vt[t]:vt[t]="on"+t}function _t(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&It(t),n.call(r,e)}function Et(t,e){if(t.Y)return!0;if(!nt){if(!e)t:{e=["window","event"];for(var n=l,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return _t(t,e=new st(e,this))}return _t(t,new st(e,this))}function St(t){return(t=t[yt])instanceof ft?t:null}var At="__closure_events_fn_"+(1e9*Math.random()>>>0);function Dt(t){return"function"===typeof t?t:(t[At]||(t[At]=function(e){return t.handleEvent(e)}),t[At])}function Nt(){_.call(this),this.c=new ft(this),this.J=this,this.C=null}function Ct(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"===typeof e)e=new ot(e,t);else if(e instanceof ot)e.target=e.target||t;else{var i=e;V(e=new ot(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.a=n[o];i=kt(s,r,!0,e)&&i}if(i=kt(s=e.a=t,r,!0,e)&&i,i=kt(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=kt(s=e.a=n[o],r,!1,e)&&i}function kt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.Y&&s.capture==n){var a=s.listener,u=s.ca||s.src;s.Z&&dt(t.c,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}T(Nt,_),Nt.prototype[ut]=!0,(u=Nt.prototype).addEventListener=function(t,e,n,r){mt(this,t,e,n,r)},u.removeEventListener=function(t,e,n,r){wt(this,t,e,n,r)},u.G=function(){if(Nt.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)lt(n[r]);delete e.a[t],e.b--}}this.C=null},u.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},u.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var xt=l.JSON.stringify;function Rt(){this.b=this.a=null}var Ot,Pt=new(function(){function t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},t}())((function(){return new Mt}),(function(t){t.reset()}));function Lt(){var t=qt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function Mt(){this.next=this.b=this.a=null}function Ft(t){l.setTimeout((function(){throw t}),0)}function Vt(t,e){Ot||function(){var t=l.Promise.resolve(void 0);Ot=function(){t.then(Bt)}}(),Ut||(Ot(),Ut=!0),qt.add(t,e)}Rt.prototype.add=function(t,e){var n=Pt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Mt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},Mt.prototype.reset=function(){this.next=this.b=this.a=null};var Ut=!1,qt=new Rt;function Bt(){for(var t;t=Lt();){try{t.a.call(t.b)}catch(n){Ft(n)}var e=Pt;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}Ut=!1}function jt(t,e){Nt.call(this),this.b=t||1,this.a=e||l,this.f=b(this.Za,this),this.g=I()}function Kt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Gt(t,e,n){if("function"===typeof t)n&&(t=b(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=b(t.handleEvent,t)}return 2147483647<Number(e)?-1:l.setTimeout(t,e||0)}function zt(t){t.a=Gt((function(){t.a=null,t.c&&(t.c=!1,zt(t))}),t.h);var e=t.b;t.b=null,t.g.apply(null,e)}T(jt,Nt),(u=jt.prototype).aa=!1,u.M=null,u.Za=function(){if(this.aa){var t=I()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Ct(this,"tick"),this.aa&&(Kt(this),this.start()))}},u.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=I())},u.G=function(){jt.X.G.call(this),Kt(this),delete this.a};var Qt=function(t){function e(e,n){var r=t.call(this)||this;return r.g=e,r.h=n,r.b=null,r.c=!1,r.a=null,r}return function(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:zt(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(l.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(_);function Ht(t){_.call(this),this.b=t,this.a={}}T(Ht,_);var Wt=[];function Yt(t,e,n,r){Array.isArray(n)||(n&&(Wt[0]=n.toString()),n=Wt);for(var i=0;i<n.length;i++){var o=mt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function Xt(t){L(t.a,(function(t,e){this.a.hasOwnProperty(e)&&It(t)}),t),t.a={}}function $t(){this.a=!0}function Jt(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return xt(n)}catch(a){return e}}(t,n)+(r?" "+r:"")}))}Ht.prototype.G=function(){Ht.X.G.call(this),Xt(this)},Ht.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},$t.prototype.info=function(){};var Zt={},te=null;function ee(){return te=te||new Nt}function ne(t){ot.call(this,Zt.Fa,t)}function re(t){var e=ee();Ct(e,new ne(e,t))}function ie(t,e){ot.call(this,Zt.STAT_EVENT,t),this.stat=e}function oe(t){var e=ee();Ct(e,new ie(e,t))}function se(t){ot.call(this,Zt.Ga,t)}function ae(t,e){if("function"!==typeof t)throw Error("Fn must not be null and must be a function");return l.setTimeout((function(){t()}),e)}Zt.Fa="serverreachability",T(ne,ot),Zt.STAT_EVENT="statevent",T(ie,ot),Zt.Ga="timingevent",T(se,ot);var ue={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},ce={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function he(){}function le(t){var e;return(e=t.a)||(e=t.a={}),e}function fe(){}he.prototype.a=null;var de,pe={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function ye(){ot.call(this,"d")}function ve(){ot.call(this,"c")}function me(){}function ge(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new Ht(this),this.P=be,t=G?125:void 0,this.R=new jt(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}T(ye,ot),T(ve,ot),T(me,he),de=new me;var be=45e3,we={},Ie={};function Te(t,e,n){t.H=1,t.i=Ge(Ve(e)),t.j=n,t.I=!0,_e(t,null)}function _e(t,e){t.u=I(),Ae(t),t.l=Ve(t.i);var n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),rn(n.b,"t",r),t.D=0,t.a=Jn(t.g,t.g.C?e:null),0<t.O&&(t.F=new Qt(b(t.Ca,t,t.a),t.O)),Yt(t.J,t.a,"readystatechange",t.Xa),e=t.B?M(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),re(1),function(t,e,n,r,i,o){t.info((function(){if(t.a)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s}))}(t.c,t.m,t.l,t.f,t.S,t.j)}function Ee(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var i=Se(t,n);if(i==Ie){4==e&&(t.h=4,oe(14),r=!1),Jt(t.c,t.f,null,"[Incomplete Response]");break}if(i==we){t.h=4,oe(15),Jt(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}Jt(t.c,t.f,i,null),xe(t,i)}4==e&&0==n.length&&(t.h=1,oe(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Gn(e),e.F=!0,oe(11))):(Jt(t.c,t.f,n,"[Invalid Chunked Response]"),ke(t),Ce(t))}function Se(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?Ie:(n=Number(e.substring(n,r)),isNaN(n)?we:(r+=1)+n>e.length?Ie:(e=e.substr(r,n),t.D=r+n,e))}function Ae(t){t.T=I()+t.P,De(t,t.P)}function De(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=ae(b(t.Va,t),e)}function Ne(t){t.o&&(l.clearTimeout(t.o),t.o=null)}function Ce(t){0==t.g.v||t.A||Hn(t.g,t)}function ke(t){Ne(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Kt(t.R),Xt(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function xe(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||ln(n.b,t)))if(n.I=t.N,!t.C&&ln(n.b,t)&&3==n.v){try{var r=n.ka.a.parse(e)}catch(Gf){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;Qn(n),Ln(n)}Kn(n),oe(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=ae(b(n.Sa,n),6e3));if(1>=hn(n.b)&&n.ea){try{n.ea()}catch(Gf){}n.ea=void 0}}else Yn(n,11)}else if((t.C||n.a==t)&&Qn(n),!N(e))for(e=r=n.ka.a.parse(e),r=0;r<e.length;r++)if(i=e[r],n.P=i[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var o=i[3];null!=o&&(n.ha=o,n.c.info("VER="+n.ha));var s=i[4];null!=s&&(n.pa=s,n.c.info("SVER="+n.pa));var a=i[5];if(null!=a&&"number"===typeof a&&0<a){var u=1.5*a;n.D=u,n.c.info("backChannelRequestTimeoutMs_="+u)}u=n;var c=t.a;if(c){var h=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=u.b;!l.a&&(x(h,"spdy")||x(h,"quic")||x(h,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(fn(l,l.b),l.b=null))}if(u.A){var f=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.na=f,Ke(u.B,u.A,f))}}n.v=3,n.f&&n.f.ta(),n.U&&(n.N=I()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var d=t;if((u=n).la=$n(u,u.C?u.ga:null,u.fa),d.C){dn(u.b,d);var p=d,y=u.D;y&&p.setTimeout(y),p.o&&(Ne(p),Ae(p)),u.a=d}else jn(u);0<n.g.length&&Vn(n)}else"stop"!=i[0]&&"close"!=i[0]||Yn(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?Yn(n,7):Pn(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);re(4)}catch(Gf){}}function Re(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(d(t)||"string"===typeof t)S(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(d(t)||"string"===typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"===typeof t)return t.split("");if(d(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),i=r.length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Oe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Oe)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Pe(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Le(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Le(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function Le(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(u=ge.prototype).setTimeout=function(t){this.P=t},u.Xa=function(t){t=t.target;var e=this.F;e&&3==kn(t)?e.f():this.Ca(t)},u.Ca=function(t){try{if(t==this.a)t:{var e=kn(this.a),n=this.a.ua(),r=this.a.W();if(!(3>e||3==e&&!G&&!this.a.$())){this.A||4!=e||7==n||re(8==n||0>=r?3:2),Ne(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=200==i,function(t,e,n,r,i,o,s){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s}))}(this.c,this.m,this.l,this.f,this.S,e,i),this.b){if(this.U&&!this.C){e:{if(this.a){var s,a=this.a;if((s=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!N(s)){var u=s;break e}}u=null}if(!u){this.b=!1,this.h=3,oe(12),ke(this),Ce(this);break t}Jt(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,xe(this,u)}this.I?(Ee(this,e,o),G&&this.b&&3==e&&(Yt(this.J,this.R,"tick",this.Wa),this.R.start())):(Jt(this.c,this.f,o,null),xe(this,o)),4==e&&ke(this),this.b&&!this.A&&(4==e?Hn(this.g,this):(this.b=!1,Ae(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,oe(12)):(this.h=0,oe(13)),ke(this),Ce(this)}}}catch(c){}},u.Wa=function(){if(this.a){var t=kn(this.a),e=this.a.$();this.D<e.length&&(Ne(this),Ee(this,t,e),this.b&&4!=t&&Ae(this))}},u.cancel=function(){this.A=!0,ke(this)},u.Va=function(){this.o=null;var t=I();0<=t-this.T?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.c,this.l),2!=this.H&&(re(3),oe(17)),ke(this),this.h=2,Ce(this)):De(this,this.T-t)},(u=Oe.prototype).K=function(){Pe(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},u.L=function(){return Pe(this),this.a.concat()},u.get=function(t,e){return Le(this.b,t)?this.b[t]:e},u.set=function(t,e){Le(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},u.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Me=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Fe(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Fe){this.a=void 0!==e?e:t.a,Ue(this,t.f),this.j=t.j,qe(this,t.c),Be(this,t.h),this.g=t.g,e=t.b;var n=new Ze;n.c=e.c,e.a&&(n.a=new Oe(e.a),n.b=e.b),je(this,n),this.i=t.i}else t&&(n=String(t).match(Me))?(this.a=!!e,Ue(this,n[1]||"",!0),this.j=ze(n[2]||""),qe(this,n[3]||"",!0),Be(this,n[4]),this.g=ze(n[5]||"",!0),je(this,n[6]||"",!0),this.i=ze(n[7]||"")):(this.a=!!e,this.b=new Ze(null,this.a))}function Ve(t){return new Fe(t)}function Ue(t,e,n){t.f=n?ze(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function qe(t,e,n){t.c=n?ze(e,!0):e}function Be(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function je(t,e,n){e instanceof Ze?(t.b=e,function(t,e){e&&!t.f&&(tn(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(en(this,e),rn(this,n,t))}),t)),t.f=e}(t.b,t.a)):(n||(e=Qe(e,$e)),t.b=new Ze(e,t.a))}function Ke(t,e,n){t.b.set(e,n)}function Ge(t){return Ke(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^I()).toString(36)),t}function ze(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Qe(t,e,n){return"string"===typeof t?(t=encodeURI(t).replace(e,He),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function He(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Fe.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Qe(e,We,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(Qe(e,We,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(Qe(n,"/"==n.charAt(0)?Xe:Ye,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",Qe(n,Je)),t.join("")};var We=/[#\/\?@]/g,Ye=/[#\?:]/g,Xe=/[#\?]/g,$e=/[#\?@]/g,Je=/#/g;function Ze(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function tn(t){t.a||(t.a=new Oe,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function en(t,e){tn(t),e=on(t,e),Le(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Le((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Pe(t)))}function nn(t,e){return tn(t),e=on(t,e),Le(t.a.b,e)}function rn(t,e,n){en(t,e),0<n.length&&(t.c=null,t.a.set(on(t,e),D(n)),t.b+=n.length)}function on(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(u=Ze.prototype).add=function(t,e){tn(this),this.c=null,t=on(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},u.forEach=function(t,e){tn(this),this.a.forEach((function(n,r){S(n,(function(n){t.call(e,n,r,this)}),this)}),this)},u.L=function(){tn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},u.K=function(t){tn(this);var e=[];if("string"===typeof t)nn(this,t)&&(e=A(e,this.a.get(on(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=A(e,t[n])}return e},u.set=function(t,e){return tn(this),this.c=null,nn(this,t=on(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},u.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},u.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.K(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var sn=function(t,e){this.b=t,this.a=e};function an(t){this.g=t||un,l.PerformanceNavigationTiming?t=0<(t=l.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(l.ia&&l.ia.ya&&l.ia.ya()&&l.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var un=10;function cn(t){return!!t.b||!!t.a&&t.a.size>=t.f}function hn(t){return t.b?1:t.a?t.a.size:0}function ln(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function fn(t,e){t.a?t.a.add(e):t.b=e}function dn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function pn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var i=a(t.a.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.s)}}catch(u){e={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return D(t.c)}function yn(){}function vn(){this.a=new yn}function mn(t,e,n){var r=n||"";try{Re(t,(function(t,n){var i=t;p(t)&&(i=xt(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(Dd){throw e.push(r+"type="+encodeURIComponent("_badmap")),Dd}}function gn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}an.prototype.cancel=function(){var t,e;if(this.c=pn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=a(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},yn.prototype.stringify=function(t){return l.JSON.stringify(t,void 0)},yn.prototype.parse=function(t){return l.JSON.parse(t,void 0)};var bn=l.JSON.parse;function wn(t){Nt.call(this),this.headers=new Oe,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=In,this.D=this.F=!1}T(wn,Nt);var In="",Tn=/^https?$/i,_n=["POST","PUT"];function En(t){return"content-type"==t.toLowerCase()}function Sn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,An(t),Nn(t)}function An(t){t.u||(t.u=!0,Ct(t,"complete"),Ct(t,"error"))}function Dn(t){if(t.b&&"undefined"!=typeof h&&(!t.s[1]||4!=kn(t)||2!=t.W()))if(t.l&&4==kn(t))Gt(t.za,0,t);else if(Ct(t,"readystatechange"),4==kn(t)){t.b=!1;try{var e,n=t.W();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.B).match(Me)[1]||null;if(!o&&l.self&&l.self.location){var s=l.self.location.protocol;o=s.substr(0,s.length-1)}i=!Tn.test(o?o.toLowerCase():"")}e=i}if(e)Ct(t,"complete"),Ct(t,"success");else{t.h=6;try{var a=2<kn(t)?t.a.statusText:""}catch(n){a=""}t.f=a+" ["+t.W()+"]",An(t)}}finally{Nn(t)}}}function Nn(t,e){if(t.a){Cn(t);var n=t.a,r=t.s[0]?f:null;t.a=null,t.s=null,e||Ct(t,"ready");try{n.onreadystatechange=r}catch(Dd){}}}function Cn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(l.clearTimeout(t.m),t.m=null)}function kn(t){return t.a?t.a.readyState:0}function xn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return L(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"===typeof t?null!=n&&encodeURIComponent(String(n)):Ke(t,e,n))}function Rn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function On(t){this.pa=0,this.g=[],this.c=new $t,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=Rn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=Rn("baseRetryDelayMs",5e3,t),this.Ra=Rn("retryDelaySeedMs",1e4,t),this.Ma=Rn("forwardChannelMaxRetries",2,t),this.ma=Rn("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new an(t&&t.concurrentRequestLimit),this.ka=new vn,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Pn(t){if(Mn(t),3==t.v){var e=t.R++,n=Ve(t.B);Ke(n,"SID",t.J),Ke(n,"RID",e),Ke(n,"TYPE","terminate"),qn(t,n),(e=new ge(t,t.c,e,void 0)).H=2,e.i=Ge(Ve(n)),n=!1,l.navigator&&l.navigator.sendBeacon&&(n=l.navigator.sendBeacon(e.i.toString(),"")),!n&&l.Image&&((new Image).src=e.i,n=!0),n||(e.a=Jn(e.g,null),e.a.ba(e.i)),e.u=I(),Ae(e)}Xn(t)}function Ln(t){t.a&&(Gn(t),t.a.cancel(),t.a=null)}function Mn(t){Ln(t),t.j&&(l.clearTimeout(t.j),t.j=null),Qn(t),t.b.cancel(),t.h&&("number"===typeof t.h&&l.clearTimeout(t.h),t.h=null)}function Fn(t,e){t.g.push(new sn(t.Oa++,e)),3==t.v&&Vn(t)}function Vn(t){cn(t.b)||t.h||(t.h=!0,Vt(t.Ba,t),t.u=0)}function Un(t,e){var n;n=e?e.f:t.R++;var r=Ve(t.B);Ke(r,"SID",t.J),Ke(r,"RID",n),Ke(r,"AID",t.P),qn(t,r),t.i&&t.l&&xn(r,t.i,t.l),n=new ge(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Bn(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),fn(t.b,n),Te(n,r,e)}function qn(t,e){t.f&&Re({},(function(t,n){Ke(e,n,t)}))}function Bn(t,e,n){n=Math.min(t.g.length,n);var r=t.f?b(t.f.Ja,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),a=!1;else try{mn(h,s,"req"+c+"_")}catch(Fr){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function jn(t){t.a||t.j||(t.T=1,Vt(t.Aa,t),t.o=0)}function Kn(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=ae(b(t.Aa,t),Wn(t,t.o)),t.o++,!0)}function Gn(t){null!=t.s&&(l.clearTimeout(t.s),t.s=null)}function zn(t){t.a=new ge(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Ve(t.la);Ke(e,"RID","rpc"),Ke(e,"SID",t.J),Ke(e,"CI",t.H?"0":"1"),Ke(e,"AID",t.P),qn(t,e),Ke(e,"TYPE","xmlhttp"),t.i&&t.l&&xn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=Ge(Ve(e)),n.j=null,n.I=!0,_e(n,t)}function Qn(t){null!=t.m&&(l.clearTimeout(t.m),t.m=null)}function Hn(t,e){var n=null;if(t.a==e){Qn(t),Gn(t),t.a=null;var r=2}else{if(!ln(t.b,e))return;n=e.s,dn(t.b,e),r=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==r){n=e.j?e.j.length:0,e=I()-e.u;var i=t.u;Ct(r=ee(),new se(r,n,e,i)),Vn(t)}else jn(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==r&&function(t,e){return!(hn(t.b)>=t.b.f-(t.h?1:0))&&(t.h?(t.g=e.s.concat(t.g),!0):!(1==t.v||2==t.v||t.u>=(t.La?0:t.Ma))&&(t.h=ae(b(t.Ba,t,e),Wn(t,t.u)),t.u++,!0))}(t,e)||2==r&&Kn(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:Yn(t,5);break;case 4:Yn(t,10);break;case 3:Yn(t,6);break;default:Yn(t,2)}}function Wn(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function Yn(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var r=b(t.Ya,t);n||(n=new Fe("//www.google.com/images/cleardot.gif"),l.location&&"http"==l.location.protocol||Ue(n,"https"),Ge(n)),function(t,e){var n=new $t;if(l.Image){var r=new Image;r.onload=w(gn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=w(gn,n,r,"TestLoadImage: error",!1,e),r.onabort=w(gn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=w(gn,n,r,"TestLoadImage: timeout",!1,e),l.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else oe(2);t.v=0,t.f&&t.f.ra(e),Xn(t),Mn(t)}function Xn(t){t.v=0,t.I=-1,t.f&&(0==pn(t.b).length&&0==t.g.length||(t.b.c.length=0,D(t.g),t.g.length=0),t.f.qa())}function $n(t,e,n){var r=function(t){return t instanceof Fe?Ve(t):new Fe(t,void 0)}(n);if(""!=r.c)e&&qe(r,e+"."+r.c),Be(r,r.h);else{var i=l.location;r=function(t,e,n,r){var i=new Fe(null,void 0);return t&&Ue(i,t),e&&qe(i,e),n&&Be(i,n),r&&(i.g=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&L(t.V,(function(t,e){Ke(r,e,t)})),e=t.A,n=t.na,e&&n&&Ke(r,e,n),Ke(r,"VER",t.ha),qn(t,r),r}function Jn(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new wn(t.Na)).F=t.C,e}function Zn(){}function tr(){if(j&&!(10<=Number(et)))throw Error("Environmental error: no available transport.")}function er(t,e){Nt.call(this),this.a=new On(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!N(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!N(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new ir(this)}function nr(t){ye.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function rr(){ve.call(this),this.status=1}function ir(t){this.a=t}(u=wn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?le(this.H):le(de),this.a.onreadystatechange=b(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(o){return void Sn(this,o)}t=n||"";var i=new Oe(this.headers);r&&Re(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=En,n=t.length,r="string"===typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"===typeof t?t.charAt(e):t[e]}(i.L()),n=l.FormData&&t instanceof l.FormData,!(0<=E(_n,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Cn(this),0<this.o&&((this.D=function(t){return j&&Z(9)&&"number"===typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=b(this.xa,this)):this.m=Gt(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(o){Sn(this,o)}},u.xa=function(){"undefined"!=typeof h&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Ct(this,"timeout"),this.abort(8))},u.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Ct(this,"complete"),Ct(this,"abort"),Nn(this))},u.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Nn(this,!0)),wn.X.G.call(this)},u.za=function(){this.j||(this.A||this.l||this.g?Dn(this):this.Ua())},u.Ua=function(){Dn(this)},u.W=function(){try{return 2<kn(this)?this.a.status:-1}catch(t){return-1}},u.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},u.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),bn(e)}},u.ua=function(){return this.h},u.Qa=function(){return"string"===typeof this.f?this.f:String(this.f)},(u=On.prototype).ha=8,u.v=1,u.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new ge(this,this.c,t,void 0),r=this.l;if(this.O&&(r?V(r=M(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"===typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Bn(this,n,e),Ke(i=Ve(this.B),"RID",t),Ke(i,"CVER",22),this.A&&Ke(i,"X-HTTP-Session-Id",this.A),qn(this,i),this.i&&r&&xn(i,this.i,r),fn(this.b,n),this.Ia&&Ke(i,"TYPE","init"),this.da?(Ke(i,"$req",e),Ke(i,"SID","null"),n.U=!0,Te(n,i,null)):Te(n,i,e),this.v=2}}else 3==this.v&&(t?Un(this,t):0==this.g.length||cn(this.b)||Un(this))},u.Aa=function(){if(this.j=null,zn(this),this.U&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=ae(b(this.Ta,this),t)}},u.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,oe(10),Ln(this),zn(this))},u.Sa=function(){null!=this.m&&(this.m=null,Ln(this),Kn(this),oe(19))},u.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),oe(2)):(this.c.info("Failed to ping google.com"),oe(1))},(u=Zn.prototype).ta=function(){},u.sa=function(){},u.ra=function(){},u.qa=function(){},u.Ja=function(){},tr.prototype.a=function(t,e){return new er(t,e)},T(er,Nt),er.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;oe(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=$n(t,null,t.fa),Vn(t)},er.prototype.close=function(){Pn(this.a)},er.prototype.h=function(t){if("string"===typeof t){var e={};e.__data__=t,Fn(this.a,e)}else this.l?((e={}).__data__=xt(t),Fn(this.a,e)):Fn(this.a,t)},er.prototype.G=function(){this.a.f=null,delete this.f,Pn(this.a),delete this.a,er.X.G.call(this)},T(nr,ye),T(rr,ve),T(ir,Zn),ir.prototype.ta=function(){Ct(this.a,"a")},ir.prototype.sa=function(t){Ct(this.a,new nr(t))},ir.prototype.ra=function(t){Ct(this.a,new rr(t))},ir.prototype.qa=function(){Ct(this.a,"b")},tr.prototype.createWebChannel=tr.prototype.a,er.prototype.send=er.prototype.h,er.prototype.open=er.prototype.g,er.prototype.close=er.prototype.close,ue.NO_ERROR=0,ue.TIMEOUT=8,ue.HTTP_ERROR=6,ce.COMPLETE="complete",fe.EventType=pe,pe.OPEN="a",pe.CLOSE="b",pe.ERROR="c",pe.MESSAGE="d",Nt.prototype.listen=Nt.prototype.va,wn.prototype.listenOnce=wn.prototype.wa,wn.prototype.getLastError=wn.prototype.Qa,wn.prototype.getLastErrorCode=wn.prototype.ua,wn.prototype.getStatus=wn.prototype.W,wn.prototype.getResponseJson=wn.prototype.Pa,wn.prototype.getResponseText=wn.prototype.$,wn.prototype.send=wn.prototype.ba;var or=function(){return new tr},sr=function(){return ee()},ar=ue,ur=ce,cr=Zt,hr={gb:0,jb:1,kb:2,Db:3,Ib:4,Fb:5,Gb:6,Eb:7,Cb:8,Hb:9,PROXY:10,NOPROXY:11,Ab:12,wb:13,xb:14,vb:15,yb:16,zb:17,bb:18,ab:19,cb:20},lr=fe,fr=wn,dr=function(t,e){return dr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},dr(t,e)};function pr(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}dr(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function yr(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(Dd){o(Dd)}}function a(t){try{u(r.throw(t))}catch(Dd){o(Dd)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))}function vr(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(Dd){a=[6,Dd],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}Object.create;function mr(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}Object.create;var gr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();gr.o=-1;var br={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},wr=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return pr(e,t),e}(Error),Ir=new o.Yd("@firebase/firestore");function Tr(){return Ir.logLevel}function _r(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Ir.logLevel<=o.in.DEBUG){var r=e.map(Ar);Ir.debug.apply(Ir,mr(["Firestore (8.3.3): "+t],r))}}function Er(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Ir.logLevel<=o.in.ERROR){var r=e.map(Ar);Ir.error.apply(Ir,mr(["Firestore (8.3.3): "+t],r))}}function Sr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Ir.logLevel<=o.in.WARN){var r=e.map(Ar);Ir.warn.apply(Ir,mr(["Firestore (8.3.3): "+t],r))}}function Ar(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function Dr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.3.3) INTERNAL ASSERTION FAILED: "+t;throw Er(e),new Error(e)}function Nr(t,e){t||Dr()}function Cr(t,e){return t}function kr(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var xr=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=kr(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function Rr(t,e){return t<e?-1:t>e?1:0}function Or(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function Pr(t){return t+"\0"}var Lr=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new wr(br.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new wr(br.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new wr(br.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new wr(br.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Rr(this.nanoseconds,t.nanoseconds):Rr(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),Mr=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new Lr(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function Fr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Vr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Ur(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var qr=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Dr(),void 0===n?n=t.length-e:n>t.length-e&&Dr(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Br=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return pr(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new wr(br.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter((function(t){return t.length>0})))}return new e(r)},e.emptyPath=function(){return new e([])},e}(qr),jr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Kr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return pr(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return jr.test(t)},e.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new wr(br.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new wr(br.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new wr(br.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new wr(br.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(qr),Gr=function(){function t(t){this.fields=t,t.sort(Kr.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return Or(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),zr=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return Rr(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();zr.EMPTY_BYTE_STRING=new zr("");var Qr=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Hr(t){if(Nr(!!t),"string"==typeof t){var e=0,n=Qr.exec(t);if(Nr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Wr(t.seconds),nanos:Wr(t.nanos)}}function Wr(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Yr(t){return"string"==typeof t?zr.fromBase64String(t):zr.fromUint8Array(t)}function Xr(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function $r(t){var e=t.mapValue.fields.__previous_value__;return Xr(e)?$r(e):e}function Jr(t){var e=Hr(t.mapValue.fields.__local_write_time__.timestampValue);return new Lr(e.seconds,e.nanos)}function Zr(t){return null==t}function ti(t){return 0===t&&1/t==-1/0}function ei(t){return"number"==typeof t&&Number.isInteger(t)&&!ti(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var ni=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(Br.fromString(e))},t.fromName=function(e){return new t(Br.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Br.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return Br.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new Br(e.slice()))},t}();function ri(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Xr(t)?4:10:Dr()}function ii(t,e){var n=ri(t);if(n!==ri(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Jr(t).isEqual(Jr(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Hr(t.timestampValue),r=Hr(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Yr(t.bytesValue).isEqual(Yr(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Wr(t.geoPointValue.latitude)===Wr(e.geoPointValue.latitude)&&Wr(t.geoPointValue.longitude)===Wr(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Wr(t.integerValue)===Wr(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Wr(t.doubleValue),r=Wr(e.doubleValue);return n===r?ti(n)===ti(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Or(t.arrayValue.values||[],e.arrayValue.values||[],ii);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Fr(n)!==Fr(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!ii(n[i],r[i])))return!1;return!0}(t,e);default:return Dr()}}function oi(t,e){return void 0!==(t.values||[]).find((function(t){return ii(t,e)}))}function si(t,e){var n=ri(t),r=ri(e);if(n!==r)return Rr(n,r);switch(n){case 0:return 0;case 1:return Rr(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=Wr(t.integerValue||t.doubleValue),r=Wr(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return ai(t.timestampValue,e.timestampValue);case 4:return ai(Jr(t),Jr(e));case 5:return Rr(t.stringValue,e.stringValue);case 6:return function(t,e){var n=Yr(t),r=Yr(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Rr(n[i],r[i]);if(0!==o)return o}return Rr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Rr(Wr(t.latitude),Wr(e.latitude));return 0!==n?n:Rr(Wr(t.longitude),Wr(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=si(n[i],r[i]);if(o)return o}return Rr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Rr(r[s],o[s]);if(0!==a)return a;var u=si(n[r[s]],i[o[s]]);if(0!==u)return u}return Rr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Dr()}}function ai(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Rr(t,e);var n=Hr(t),r=Hr(e),i=Rr(n.seconds,r.seconds);return 0!==i?i:Rr(n.nanos,r.nanos)}function ui(t){return ci(t)}function ci(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=Hr(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Yr(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,ni.fromName(n).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=ci(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+ci(t.fields[o])}return e+"}"}(t.mapValue):Dr();var e,n}function hi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function li(t){return!!t&&"integerValue"in t}function fi(t){return!!t&&"arrayValue"in t}function di(t){return!!t&&"nullValue"in t}function pi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function yi(t){return!!t&&"mapValue"in t}var vi=function(){function t(t){this.overlayMap=new Map,this.partialValue=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(e){return t.extractNestedValue(this.buildProto(),e)},t.prototype.toProto=function(){return this.field(Kr.emptyPath())},t.prototype.set=function(t,e){this.setOverlay(t,e)},t.prototype.setAll=function(t){var e=this;t.forEach((function(t,n){t?e.set(n,t):e.delete(n)}))},t.prototype.delete=function(t){this.setOverlay(t,null)},t.prototype.isEqual=function(t){return ii(this.buildProto(),t.buildProto())},t.prototype.setOverlay=function(t,e){for(var n=this.overlayMap,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===ri(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.lastSegment(),e)},t.prototype.applyOverlay=function(e,n){var r=this,i=!1,o=t.extractNestedValue(this.partialValue,e),s=yi(o)?Object.assign({},o.mapValue.fields):{};return n.forEach((function(t,n){if(t instanceof Map){var o=r.applyOverlay(e.child(n),t);null!=o&&(s[n]=o,i=!0)}else null!==t?(s[n]=t,i=!0):s.hasOwnProperty(n)&&(delete s[n],i=!0)})),i?{mapValue:{fields:s}}:null},t.prototype.buildProto=function(){var t=this.applyOverlay(Kr.emptyPath(),this.overlayMap);return null!=t&&(this.partialValue=t,this.overlayMap.clear()),this.partialValue},t.extractNestedValue=function(t,e){if(e.isEmpty())return t;for(var n=t,r=0;r<e.length-1;++r){if(!n.mapValue.fields)return null;if(!yi(n=n.mapValue.fields[e.get(r)]))return null}return(n=(n.mapValue.fields||{})[e.lastSegment()])||null},t.prototype.clone=function(){return new t(this.buildProto())},t}();function mi(t){var e=[];return Vr(t.fields||{},(function(t,n){var r=new Kr([t]);if(yi(n)){var i=mi(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var a=s[o];e.push(r.child(a))}}else e.push(r)})),new Gr(e)}var gi=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,Mr.min(),vi.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,vi.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,vi.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=vi.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=vi.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.toProto())+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),bi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function wi(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new bi(t,e,n,r,i,o,s)}function Ii(t){var e=Cr(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.canonicalString()+t.op.toString()+ui(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return function(t){return t.field.canonicalString()+t.dir}(t)})).join(","),Zr(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Pi(e.startAt)),e.endAt&&(n+="|ub:",n+=Pi(e.endAt)),e.h=n}return e.h}function Ti(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Mi(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!ii(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Vi(t.startAt,e.startAt)&&Vi(t.endAt,e.endAt)}function _i(t){return ni.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Ei=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return pr(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new Si(t,n,r):"array-contains"===n?new Ci(t,r):"in"===n?new ki(t,r):"not-in"===n?new xi(t,r):"array-contains-any"===n?new Ri(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new Ai(t,n):new Di(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(si(e,this.value)):null!==e&&ri(this.value)===ri(e)&&this.m(si(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Dr()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}((function(){})),Si=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=ni.fromName(r.referenceValue),i}return pr(e,t),e.prototype.matches=function(t){var e=ni.comparator(t.key,this.key);return this.m(e)},e}(Ei),Ai=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=Ni("in",n),r}return pr(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(Ei),Di=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=Ni("not-in",n),r}return pr(e,t),e.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},e}(Ei);function Ni(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return ni.fromName(t.referenceValue)}))}var Ci=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return pr(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return fi(e)&&oi(e.arrayValue,this.value)},e}(Ei),ki=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return pr(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&oi(this.value.arrayValue,e)},e}(Ei),xi=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return pr(e,t),e.prototype.matches=function(t){if(oi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!oi(this.value.arrayValue,e)},e}(Ei),Ri=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return pr(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!fi(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return oi(e.value.arrayValue,t)}))},e}(Ei),Oi=function(t,e){this.position=t,this.before=e};function Pi(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return ui(t)})).join(",")}var Li=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Mi(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Fi(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?ni.comparator(ni.fromName(s.referenceValue),n.key):si(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Vi(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!ii(t.position[n],e.position[n]))return!1;return!0}var Ui=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function qi(t,e,n,r,i,o,s,a){return new Ui(t,e,n,r,i,o,s,a)}function Bi(t){return new Ui(t)}function ji(t){return!Zr(t.limit)&&"F"===t.limitType}function Ki(t){return!Zr(t.limit)&&"L"===t.limitType}function Gi(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function zi(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Qi(t){return null!==t.collectionGroup}function Hi(t){var e=Cr(t);if(null===e.p){e.p=[];var n=zi(e),r=Gi(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new Li(n)),e.p.push(new Li(Kr.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new Li(Kr.keyField(),u))}}}return e.p}function Wi(t){var e=Cr(t);if(!e.T)if("F"===e.limitType)e.T=wi(e.path,e.collectionGroup,Hi(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Hi(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new Li(o.field,s))}var a=e.endAt?new Oi(e.endAt.position,!e.endAt.before):null,u=e.startAt?new Oi(e.startAt.position,!e.startAt.before):null;e.T=wi(e.path,e.collectionGroup,n,e.filters,e.limit,a,u)}return e.T}function Yi(t,e,n){return new Ui(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Xi(t,e){return Ti(Wi(t),Wi(e))&&t.limitType===e.limitType}function $i(t){return Ii(Wi(t))+"|lt:"+t.limitType}function Ji(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.canonicalString()+" "+e.op+" "+ui(e.value);var e})).join(", ")+"]"),Zr(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Pi(t.startAt)),t.endAt&&(e+=", endAt: "+Pi(t.endAt)),"Target("+e+")"}(Wi(t))+"; limitType="+t.limitType+")"}function Zi(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):ni.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Fi(t.startAt,Hi(t),e))&&(!t.endAt||!Fi(t.endAt,Hi(t),e))}(t,e)}function to(t){return function(e,n){for(var r=!1,i=0,o=Hi(t);i<o.length;i++){var s=o[i],a=eo(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function eo(t,e,n){var r=t.field.isKeyField()?ni.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?si(r,i):Dr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Dr()}}function no(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ti(e)?"-0":e}}function ro(t){return{integerValue:""+t}}function io(t,e){return ei(e)?ro(e):no(t,e)}var oo=function(){this._=void 0};function so(t,e,n){return t instanceof co?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof ho?lo(t,e):t instanceof fo?po(t,e):function(t,e){var n=uo(t,e),r=vo(n)+vo(t.A);return li(n)&&li(t.A)?ro(r):no(t.R,r)}(t,e)}function ao(t,e,n){return t instanceof ho?lo(t,e):t instanceof fo?po(t,e):n}function uo(t,e){return t instanceof yo?li(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var co=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return pr(e,t),e}(oo),ho=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return pr(e,t),e}(oo);function lo(t,e){for(var n=mo(e),r=function(t){n.some((function(e){return ii(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var fo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return pr(e,t),e}(oo);function po(t,e){for(var n=mo(e),r=function(t){n=n.filter((function(e){return!ii(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var yo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return pr(e,t),e}(oo);function vo(t){return Wr(t.integerValue||t.doubleValue)}function mo(t){return fi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var go=function(t,e){this.field=t,this.transform=e},bo=function(t,e){this.version=t,this.transformResults=e},wo=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Io(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var To=function(){};function _o(t,e,n){t instanceof No?function(t,e,n){var r=t.value.clone(),i=xo(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Co?function(t,e,n){if(Io(t.precondition,e)){var r=xo(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(ko(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Eo(t,e,n){t instanceof No?function(t,e,n){if(Io(t.precondition,e)){var r=t.value.clone(),i=Ro(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(Do(e),r).setHasLocalMutations()}}(t,e,n):t instanceof Co?function(t,e,n){if(Io(t.precondition,e)){var r=Ro(t.fieldTransforms,n,e),i=e.data;i.setAll(ko(t)),i.setAll(r),e.convertToFoundDocument(Do(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){Io(t.precondition,e)&&e.convertToNoDocument(Mr.min())}(t,e)}function So(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=uo(o.transform,s||null);null!=a&&(null==n&&(n=vi.empty()),n.set(o.field,a))}return n||null}function Ao(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Or(t,e,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof ho&&e instanceof ho||t instanceof fo&&e instanceof fo?Or(t.elements,e.elements,ii):t instanceof yo&&e instanceof yo?ii(t.A,e.A):t instanceof co&&e instanceof co}(t.transform,e.transform)}(t,e)}))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function Do(t){return t.isFoundDocument()?t.version:Mr.min()}var No=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return pr(e,t),e}(To),Co=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return pr(e,t),e}(To);function ko(t){var e=new Map;return t.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}})),e}function xo(t,e,n){var r=new Map;Nr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,ao(s,a,n[i]))}return r}function Ro(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,so(a,u,e))}return r}var Oo,Po,Lo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return pr(e,t),e}(To),Mo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return pr(e,t),e}(To),Fo=function(t){this.count=t};function Vo(t){switch(t){case br.OK:return Dr();case br.CANCELLED:case br.UNKNOWN:case br.DEADLINE_EXCEEDED:case br.RESOURCE_EXHAUSTED:case br.INTERNAL:case br.UNAVAILABLE:case br.UNAUTHENTICATED:return!1;case br.INVALID_ARGUMENT:case br.NOT_FOUND:case br.ALREADY_EXISTS:case br.PERMISSION_DENIED:case br.FAILED_PRECONDITION:case br.ABORTED:case br.OUT_OF_RANGE:case br.UNIMPLEMENTED:case br.DATA_LOSS:return!0;default:return Dr()}}function Uo(t){if(void 0===t)return Er("GRPC error has no .code"),br.UNKNOWN;switch(t){case Oo.OK:return br.OK;case Oo.CANCELLED:return br.CANCELLED;case Oo.UNKNOWN:return br.UNKNOWN;case Oo.DEADLINE_EXCEEDED:return br.DEADLINE_EXCEEDED;case Oo.RESOURCE_EXHAUSTED:return br.RESOURCE_EXHAUSTED;case Oo.INTERNAL:return br.INTERNAL;case Oo.UNAVAILABLE:return br.UNAVAILABLE;case Oo.UNAUTHENTICATED:return br.UNAUTHENTICATED;case Oo.INVALID_ARGUMENT:return br.INVALID_ARGUMENT;case Oo.NOT_FOUND:return br.NOT_FOUND;case Oo.ALREADY_EXISTS:return br.ALREADY_EXISTS;case Oo.PERMISSION_DENIED:return br.PERMISSION_DENIED;case Oo.FAILED_PRECONDITION:return br.FAILED_PRECONDITION;case Oo.ABORTED:return br.ABORTED;case Oo.OUT_OF_RANGE:return br.OUT_OF_RANGE;case Oo.UNIMPLEMENTED:return br.UNIMPLEMENTED;case Oo.DATA_LOSS:return br.DATA_LOSS;default:return Dr()}}(Po=Oo||(Oo={}))[Po.OK=0]="OK",Po[Po.CANCELLED=1]="CANCELLED",Po[Po.UNKNOWN=2]="UNKNOWN",Po[Po.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Po[Po.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Po[Po.NOT_FOUND=5]="NOT_FOUND",Po[Po.ALREADY_EXISTS=6]="ALREADY_EXISTS",Po[Po.PERMISSION_DENIED=7]="PERMISSION_DENIED",Po[Po.UNAUTHENTICATED=16]="UNAUTHENTICATED",Po[Po.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Po[Po.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Po[Po.ABORTED=10]="ABORTED",Po[Po.OUT_OF_RANGE=11]="OUT_OF_RANGE",Po[Po.UNIMPLEMENTED=12]="UNIMPLEMENTED",Po[Po.INTERNAL=13]="INTERNAL",Po[Po.UNAVAILABLE=14]="UNAVAILABLE",Po[Po.DATA_LOSS=15]="DATA_LOSS";var qo=function(){function t(t,e){this.comparator=t,this.root=e||jo.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,jo.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,jo.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Bo(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Bo(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Bo(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Bo(this.root,t,this.comparator,!0)},t}(),Bo=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),jo=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Dr();if(this.right.isRed())throw Dr();var t=this.left.check();if(t!==this.right.check())throw Dr();return t+(this.isRed()?0:1)},t}();jo.EMPTY=null,jo.RED=!0,jo.BLACK=!1,jo.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Dr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Dr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Dr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Dr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Dr()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new jo(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var Ko=function(){function t(t){this.comparator=t,this.data=new qo(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new Go(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new Go(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Go=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),zo=new qo(ni.comparator);function Qo(){return zo}var Ho=new qo(ni.comparator);function Wo(){return Ho}var Yo=new qo(ni.comparator);function Xo(){return Yo}var $o=new Ko(ni.comparator);function Jo(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=$o,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Zo=new Ko(Rr);function ts(){return Zo}var es=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,ns.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(Mr.min(),r,ts(),Qo(),Jo())},t}(),ns=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(zr.EMPTY_BYTE_STRING,n,Jo(),Jo(),Jo())},t}(),rs=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},is=function(t,e){this.targetId=t,this.V=e},os=function(t,e,n,r){void 0===n&&(n=zr.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},ss=function(){function t(){this.S=0,this.D=cs(),this.C=zr.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"O",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.$=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=Jo(),e=Jo(),n=Jo();return this.D.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Dr()}})),new ns(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=cs()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),as=function(){function t(t){this.W=t,this.G=new Map,this.H=Qo(),this.J=us(),this.Y=new Ko(Rr)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.tt(r,t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.$(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.$(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.$(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.$(t.resumeToken));break;default:Dr()}}))},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach((function(t,r){n.st(r)&&e(r)}))},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(_i(i))if(0===n){var o=new ni(i.path);this.tt(e,o,gi.newNoDocument(o,Mr.min()))}else Nr(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach((function(r,i){var o=e.ot(i);if(o){if(r.current&&_i(o.target)){var s=new ni(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,gi.newNoDocument(s,t))}r.O&&(n.set(i,r.M()),r.L())}}));var r=Jo();this.J.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new es(t,n,this.Y,this.H,r);return this.H=Qo(),this.J=us(),this.Y=new Ko(Rr),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new ss,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Ko(Rr),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||_r("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new ss),this.W.getRemoteKeysForTarget(t).forEach((function(n){e.tt(t,n,null)}))},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function us(){return new qo(ni.comparator)}function cs(){return new qo(ni.comparator)}var hs={asc:"ASCENDING",desc:"DESCENDING"},ls={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},fs=function(t,e){this.databaseId=t,this.I=e};function ds(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ps(t,e){return t.I?e.toBase64():e.toUint8Array()}function ys(t,e){return ds(t,e.toTimestamp())}function vs(t){return Nr(!!t),Mr.fromTimestamp(function(t){var e=Hr(t);return new Lr(e.seconds,e.nanos)}(t))}function ms(t,e){return function(t){return new Br(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function gs(t){var e=Br.fromString(t);return Nr(js(e)),e}function bs(t,e){return ms(t.databaseId,e.path)}function ws(t,e){var n=gs(e);if(n.get(1)!==t.databaseId.projectId)throw new wr(br.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new wr(br.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ni(Es(n))}function Is(t,e){return ms(t.databaseId,e)}function Ts(t){var e=gs(t);return 4===e.length?Br.emptyPath():Es(e)}function _s(t){return new Br(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Es(t){return Nr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Ss(t,e,n){return{name:bs(t,e),fields:n.toProto().mapValue.fields}}function As(t,e,n){var r=ws(t,e.name),i=vs(e.updateTime),o=new vi({mapValue:{fields:e.fields}}),s=gi.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function Ds(t,e){var n;if(e instanceof No)n={update:Ss(t,e.key,e.value)};else if(e instanceof Lo)n={delete:bs(t,e.key)};else if(e instanceof Co)n={update:Ss(t,e.key,e.data),updateMask:Bs(e.fieldMask)};else{if(!(e instanceof Mo))return Dr();n={verify:bs(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof co)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof ho)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof fo)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof yo)return{fieldPath:e.field.canonicalString(),increment:n.A};throw Dr()}(0,t)}))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:ys(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Dr()}(t,e.precondition)),n}function Ns(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?wo.updateTime(vs(t.updateTime)):void 0!==t.exists?wo.exists(t.exists):wo.none()}(e.currentDocument):wo.none(),r=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)Nr("REQUEST_TIME"===e.setToServerValue),n=new co;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new ho(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new fo(i)}else"increment"in e?n=new yo(t,e.increment):Dr();var o=Kr.fromServerFormat(e.fieldPath);return new go(o,n)}(t,e)})):[];if(e.update){e.update.name;var i=ws(t,e.update.name),o=new vi({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){var e=t.fieldPaths||[];return new Gr(e.map((function(t){return Kr.fromServerFormat(t)})))}(e.updateMask);return new Co(i,o,s,n,r)}return new No(i,o,n,r)}if(e.delete){var a=ws(t,e.delete);return new Lo(a,n)}if(e.verify){var u=ws(t,e.verify);return new Mo(u,n)}return Dr()}function Cs(t,e){return{documents:[Is(t,e.path)]}}function ks(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Is(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Is(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(pi(t.value))return{unaryFilter:{field:Fs(t.field),op:"IS_NAN"}};if(di(t.value))return{unaryFilter:{field:Fs(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(pi(t.value))return{unaryFilter:{field:Fs(t.field),op:"IS_NOT_NAN"}};if(di(t.value))return{unaryFilter:{field:Fs(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Fs(t.field),op:Ms(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return function(t){return{field:Fs(t.field),direction:Ls(t.dir)}}(t)}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||Zr(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=Os(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Os(e.endAt)),n}function xs(t){var e=Ts(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Nr(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=Rs(n.where));var a=[];n.orderBy&&(a=n.orderBy.map((function(t){return function(t){return new Li(Vs(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)})));var u=null;n.limit&&(u=function(t){var e;return Zr(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Ps(n.startAt));var h=null;return n.endAt&&(h=Ps(n.endAt)),qi(e,i,a,s,u,"F",c,h)}function Rs(t){return t?void 0!==t.unaryFilter?[qs(t)]:void 0!==t.fieldFilter?[Us(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((function(t){return Rs(t)})).reduce((function(t,e){return t.concat(e)})):Dr():[]}function Os(t){return{before:t.before,values:t.position}}function Ps(t){var e=!!t.before,n=t.values||[];return new Oi(n,e)}function Ls(t){return hs[t]}function Ms(t){return ls[t]}function Fs(t){return{fieldPath:t.canonicalString()}}function Vs(t){return Kr.fromServerFormat(t.fieldPath)}function Us(t){return Ei.create(Vs(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Dr()}}(t.fieldFilter.op),t.fieldFilter.value)}function qs(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Vs(t.unaryFilter.field);return Ei.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Vs(t.unaryFilter.field);return Ei.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Vs(t.unaryFilter.field);return Ei.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Vs(t.unaryFilter.field);return Ei.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Dr()}}function Bs(t){var e=[];return t.fields.forEach((function(t){return e.push(t.canonicalString())})),{fieldPaths:e}}function js(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function Ks(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=zs(e)),e=Gs(t.get(n),e);return zs(e)}function Gs(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function zs(t){return t+"\x01\x01"}function Qs(t){var e=t.length;if(Nr(e>=2),2===e)return Nr("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),Br.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&Dr(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:Dr()}o=s+2}return new Br(r)}var Hs=function(t,e){this.seconds=t,this.nanoseconds=e},Ws=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Ws.store="owner",Ws.key="owner";var Ys=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Ys.store="mutationQueues",Ys.keyPath="userId";var Xs=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Xs.store="mutations",Xs.keyPath="batchId",Xs.userMutationsIndex="userMutationsIndex",Xs.userMutationsKeyPath=["userId","batchId"];var $s=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Ks(e)]},t.key=function(t,e,n){return[t,Ks(e),n]},t}();$s.store="documentMutations",$s.PLACEHOLDER=new $s;var Js=function(t,e){this.path=t,this.readTime=e},Zs=function(t,e){this.path=t,this.version=e},ta=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};ta.store="remoteDocuments",ta.readTimeIndex="readTimeIndex",ta.readTimeIndexPath="readTime",ta.collectionReadTimeIndex="collectionReadTimeIndex",ta.collectionReadTimeIndexPath=["parentPath","readTime"];var ea=function(t){this.byteSize=t};ea.store="remoteDocumentGlobal",ea.key="remoteDocumentGlobalKey";var na=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};na.store="targets",na.keyPath="targetId",na.queryTargetsIndexName="queryTargetsIndex",na.queryTargetsKeyPath=["canonicalId","targetId"];var ra=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};ra.store="targetDocuments",ra.keyPath=["targetId","path"],ra.documentTargetsIndex="documentTargetsIndex",ra.documentTargetsKeyPath=["path","targetId"];var ia=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};ia.key="targetGlobalKey",ia.store="targetGlobal";var oa=function(t,e){this.collectionId=t,this.parent=e};oa.store="collectionParents",oa.keyPath=["collectionId","parent"];var sa=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};sa.store="clientMetadata",sa.keyPath="clientId";var aa=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};aa.store="bundles",aa.keyPath="bundleId";var ua=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};ua.store="namedQueries",ua.keyPath="name";var ca=mr(mr([],mr(mr([],mr(mr([],mr(mr([],[Ys.store,Xs.store,$s.store,ta.store,na.store,Ws.store,ia.store,ra.store]),[sa.store])),[ea.store])),[oa.store])),[aa.store,ua.store]),ha="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",la=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},t}(),fa=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},da=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Dr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}}))},t.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.waitFor=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},t}(),pa=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new fa,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new ma(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=Ta(e.target.error);n.ft.reject(new ma(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new ma(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(_r("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new ba(e)},t}(),ya=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t((0,i.z$)())&&Er("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return _r("SimpleDb","Removing database:",t),wa(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=(0,i.z$)(),n=t._t(e),r=0<n&&n<10,o=t.Et(e),s=0<o&&o<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t={NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_BACKEND_V2_GET_URL:"https://json.excalidraw.com/api/v2/",REACT_APP_BACKEND_V2_POST_URL:"https://json.excalidraw.com/api/v2/post/",REACT_APP_FIREBASE_CONFIG:'{"apiKey":"AIzaSyAd15pYlMci_xIp9ko6wkEsDzAAA0Dn0RU","authDomain":"excalidraw-room-persistence.firebaseapp.com","databaseURL":"https://excalidraw-room-persistence.firebaseio.com","projectId":"excalidraw-room-persistence","storageBucket":"excalidraw-room-persistence.appspot.com","messagingSenderId":"654800341332","appId":"1:654800341332:web:4a692de832b55bd57ce0c1"}',REACT_APP_GIT_SHA:"",REACT_APP_GOOGLE_ANALYTICS_ID:"UA-387204-13",REACT_APP_LIBRARY_BACKEND:"https://us-central1-excalidraw-room-persistence.cloudfunctions.net/libraries",REACT_APP_LIBRARY_URL:"https://libraries.excalidraw.com",REACT_APP_PLUS_APP:"https://app.excalidraw.com",REACT_APP_PORTAL_URL:"https://portal.excalidraw.com",REACT_APP_WS_SERVER_URL:""})||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return yr(this,void 0,void 0,(function(){var e,n=this;return vr(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(_r("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new ma(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new wr(br.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new ma(t,n))},i.onupgradeneeded=function(t){_r("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;n.wt.Rt(e,i.transaction,t.oldVersion,n.version).next((function(){_r("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}}))}))},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return yr(this,void 0,void 0,(function(){var i,o,s,a,u;return vr(this,(function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,u,c,h;return vr(this,(function(l){switch(l.label){case 0:++o,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=l.sent(),e=pa.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch((function(t){return e.abort(t),da.reject(t)})).toPromise(),u={},s.catch((function(){})),[4,e.dt];case 3:return[2,(u.value=(l.sent(),s),u)];case 4:return c=l.sent(),h="FirebaseError"!==c.name&&o<3,_r("SimpleDb","Transaction failed with error:",c.message,"Retrying:",h),a.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}}))},a=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}}))}))},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),va=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return wa(this.Pt.delete())},t}(),ma=function(t){function e(e,n){var r=this;return(r=t.call(this,br.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return pr(e,t),e}(wr);function ga(t){return"IndexedDbTransactionError"===t.name}var ba=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(_r("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(_r("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),wa(n)},t.prototype.add=function(t){return _r("SimpleDb","ADD",this.store.name,t,t),wa(this.store.add(t))},t.prototype.get=function(t){var e=this;return wa(this.store.get(t)).next((function(n){return void 0===n&&(n=null),_r("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return _r("SimpleDb","DELETE",this.store.name,t),wa(this.store.delete(t))},t.prototype.count=function(){return _r("SimpleDb","COUNT",this.store.name),wa(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.Ft=function(t,e){_r("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,(function(t,e,n){return n.delete()}))},t.prototype.Ot=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.$t=function(t){var e=this.cursor({});return new da((function(n,r){e.onerror=function(t){var e=Ta(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.xt=function(t,e){var n=[];return new da((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new va(i),s=e(i.primaryKey,i.value,o);if(s instanceof da){var a=s.catch((function(t){return o.done(),da.reject(t)}));n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}})).next((function(){return da.waitFor(n)}))},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function wa(t){return new da((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=Ta(t.target.error);n(e)}}))}var Ia=!1;function Ta(t){var e=ya._t((0,i.z$)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new wr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ia||(Ia=!0,setTimeout((function(){throw r}),0)),r}}return t}var _a=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return pr(e,t),e}(la);function Ea(t,e){var n=Cr(t);return ya.It(n.Mt,e)}var Sa=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&_o(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&Eo(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&Eo(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach((function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(Mr.min())}))},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),Jo())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Or(this.mutations,t.mutations,(function(t,e){return Ao(t,e)}))&&Or(this.baseMutations,t.baseMutations,(function(t,e){return Ao(t,e)}))},t}(),Aa=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){Nr(e.mutations.length===r.length);for(var i=Xo(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Da=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=Mr.min()),void 0===o&&(o=Mr.min()),void 0===s&&(s=zr.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),Na=function(t){this.Lt=t};function Ca(t,e){if(e.document)return As(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=ni.fromSegments(e.noDocument.path),r=Pa(e.noDocument.readTime),i=gi.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=ni.fromSegments(e.unknownDocument.path);return r=Pa(e.unknownDocument.version),gi.newUnknownDocument(o,r)}return Dr()}function ka(t,e,n){var r=xa(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:bs(t,e.key),fields:e.data.toProto().mapValue.fields,updateTime:ds(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new ta(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=Oa(e.version);return s=e.hasCommittedMutations,new ta(null,new Js(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=Oa(e.version);return new ta(new Zs(c,h),null,null,!0,r,i)}return Dr()}function xa(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Ra(t){var e=new Lr(t[0],t[1]);return Mr.fromTimestamp(e)}function Oa(t){var e=t.toTimestamp();return new Hs(e.seconds,e.nanoseconds)}function Pa(t){var e=new Lr(t.seconds,t.nanoseconds);return Mr.fromTimestamp(e)}function La(t,e){for(var n=(e.baseMutations||[]).map((function(e){return Ns(t.Lt,e)})),r=0;r<e.mutations.length-1;++r){var i=e.mutations[r];if(r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform){var o=e.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}var s=e.mutations.map((function(e){return Ns(t.Lt,e)})),a=Lr.fromMillis(e.localWriteTimeMs);return new Sa(e.batchId,a,n,s)}function Ma(t){var e,n,r=Pa(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Pa(t.lastLimboFreeSnapshotVersion):Mr.min();return void 0!==t.query.documents?(Nr(1===(n=t.query).documents.length),e=Wi(Bi(Ts(n.documents[0])))):e=function(t){return Wi(xs(t))}(t.query),new Da(e,t.targetId,0,t.lastListenSequenceNumber,r,i,zr.fromBase64String(t.resumeToken))}function Fa(t,e){var n,r=Oa(e.snapshotVersion),i=Oa(e.lastLimboFreeSnapshotVersion);n=_i(e.target)?Cs(t.Lt,e.target):ks(t.Lt,e.target);var o=e.resumeToken.toBase64();return new na(e.targetId,Ii(e.target),r,o,e.sequenceNumber,i,n)}function Va(t){var e=xs({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Yi(e,e.limit,"L"):e}var Ua=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return qa(t).get(e).next((function(t){if(t)return{id:(e=t).bundleId,createTime:Pa(e.createTime),version:e.version};var e}))},t.prototype.saveBundleMetadata=function(t,e){return qa(t).put({bundleId:(n=e).id,createTime:Oa(vs(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return Ba(t).get(e).next((function(t){if(t)return{name:(e=t).name,query:Va(e.bundledQuery),readTime:Pa(e.readTime)};var e}))},t.prototype.saveNamedQuery=function(t,e){return Ba(t).put(function(t){return{name:t.name,readTime:Oa(vs(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function qa(t){return Ea(t,aa.store)}function Ba(t){return Ea(t,ua.store)}var ja=function(){function t(){this.Bt=new Ka}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),da.resolve()},t.prototype.getCollectionParents=function(t,e){return da.resolve(this.Bt.getEntries(e))},t}(),Ka=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Ko(Br.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Ko(Br.comparator)).toArray()},t}(),Ga=function(){function t(){this.qt=new Ka}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((function(){n.qt.add(e)}));var o={collectionId:r,parent:Ks(i)};return za(t).put(o)}return da.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Pr(e),""],!1,!0);return za(t).Nt(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Qs(o.parent))}return n}))},t}();function za(t){return Ea(t,oa.store)}var Qa={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ha=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function Wa(t,e,n){var r=t.store(Xs.store),i=t.store($s.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.Ot({range:s},(function(t,e,n){return a++,n.delete()}));o.push(u.next((function(){Nr(1===a)})));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=$s.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return da.waitFor(o).next((function(){return c}))}function Ya(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Dr();e=t.noDocument}return JSON.stringify(e).length}Ha.DEFAULT_COLLECTION_PERCENTILE=10,Ha.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ha.DEFAULT=new Ha(41943040,Ha.DEFAULT_COLLECTION_PERCENTILE,Ha.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ha.DISABLED=new Ha(-1,0,0);var Xa=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Qt={}}return t.Kt=function(e,n,r,i){return Nr(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ja(t).Ot({index:Xs.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=Za(t),s=Ja(t);return s.add({}).next((function(a){Nr("number"==typeof a);for(var u=new Sa(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return Ds(t.Lt,e)})),i=n.mutations.map((function(e){return Ds(t.Lt,e)}));return new Xs(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new Ko((function(t,e){return Rr(t.canonicalString(),e.canonicalString())})),f=0,d=r;f<d.length;f++){var p=d[f],y=$s.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,$s.PLACEHOLDER))}return l.forEach((function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.Qt[a]=u.keys()})),da.waitFor(h).next((function(){return u}))}))},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Ja(t).get(e).next((function(t){return t?(Nr(t.userId===n.userId),La(n.R,t)):null}))},t.prototype.jt=function(t,e){var n=this;return this.Qt[e]?da.resolve(this.Qt[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){var r=t.keys();return n.Qt[e]=r,r}return null}))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Ja(t).Ot({index:Xs.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(Nr(e.batchId>=r),o=La(n.R,e)),i.done()})).next((function(){return o}))},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Ja(t).Ot({index:Xs.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ja(t).Nt(Xs.userMutationsIndex,n).next((function(t){return t.map((function(t){return La(e.R,t)}))}))},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=$s.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Za(t).Ot({range:i},(function(r,i,s){var a=r[0],u=r[1],c=r[2],h=Qs(u);if(a===n.userId&&e.path.isEqual(h))return Ja(t).get(c).next((function(t){if(!t)throw Dr();Nr(t.userId===n.userId),o.push(La(n.R,t))}));s.done()})).next((function(){return o}))},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Ko(Rr),i=[];return e.forEach((function(e){var o=$s.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=Za(t).Ot({range:s},(function(t,i,o){var s=t[0],a=t[1],u=t[2],c=Qs(a);s===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()}));i.push(a)})),da.waitFor(i).next((function(){return n.Wt(t,r)}))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=$s.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new Ko(Rr);return Za(t).Ot({range:s},(function(t,e,o){var s=t[0],u=t[1],c=t[2],h=Qs(u);s===n.userId&&r.isPrefixOf(h)?h.length===i&&(a=a.add(c)):o.done()})).next((function(){return n.Wt(t,a)}))},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(Ja(t).get(e).next((function(t){if(null===t)throw Dr();Nr(t.userId===n.userId),r.push(La(n.R,t))})))})),da.waitFor(i).next((function(){return r}))},t.prototype.removeMutationBatch=function(t,e){var n=this;return Wa(t.Mt,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.Gt(e.batchId)})),da.forEach(r,(function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)}))}))},t.prototype.Gt=function(t){delete this.Qt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return da.resolve();var r=IDBKeyRange.lowerBound($s.prefixForUser(e.userId)),i=[];return Za(t).Ot({range:r},(function(t,n,r){if(t[0]===e.userId){var o=Qs(t[1]);i.push(o)}else r.done()})).next((function(){Nr(0===i.length)}))}))},t.prototype.containsKey=function(t,e){return $a(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return tu(t).get(this.userId).next((function(t){return t||new Ys(e.userId,-1,"")}))},t}();function $a(t,e,n){var r=$s.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Za(t).Ot({range:o,kt:!0},(function(t,n,r){var o=t[0],a=t[1];t[2],o===e&&a===i&&(s=!0),r.done()})).next((function(){return s}))}function Ja(t){return Ea(t,Xs.store)}function Za(t){return Ea(t,$s.store)}function tu(t){return Ea(t,Ys.store)}var eu=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),nu=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next((function(n){var r=new eu(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next((function(t){return Mr.fromTimestamp(new Lr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)}))},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next((function(){return n.Xt(t).next((function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)}))}))},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return ru(t).delete(e.targetId)})).next((function(){return n.Xt(t)})).next((function(e){return Nr(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)}))},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return ru(t).Ot((function(s,a){var u=Ma(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))})).next((function(){return da.waitFor(o)})).next((function(){return i}))},t.prototype.forEachTarget=function(t,e){return ru(t).Ot((function(t,n){var r=Ma(n);e(r)}))},t.prototype.Xt=function(t){return iu(t).get(ia.key).next((function(t){return Nr(null!==t),t}))},t.prototype.Zt=function(t,e){return iu(t).put(ia.key,e)},t.prototype.te=function(t,e){return ru(t).put(Fa(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next((function(t){return t.targetCount}))},t.prototype.getTargetData=function(t,e){var n=Ii(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return ru(t).Ot({range:r,index:na.queryTargetsIndexName},(function(t,n,r){var o=Ma(n);Ti(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=ou(t);return e.forEach((function(e){var s=Ks(e.path);i.push(o.put(new ra(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))})),da.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=ou(t);return da.forEach(e,(function(e){var o=Ks(e.path);return da.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])}))},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=ou(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=ou(t),i=Jo();return r.Ot({range:n,kt:!0},(function(t,e,n){var r=Qs(t[1]),o=new ni(r);i=i.add(o)})).next((function(){return i}))},t.prototype.containsKey=function(t,e){var n=Ks(e.path),r=IDBKeyRange.bound([n],[Pr(n)],!1,!0),i=0;return ou(t).Ot({index:ra.documentTargetsIndex,kt:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.lt=function(t,e){return ru(t).get(e).next((function(t){return t?Ma(t):null}))},t}();function ru(t){return Ea(t,na.store)}function iu(t){return Ea(t,ia.store)}function ou(t){return Ea(t,ra.store)}function su(t){return yr(this,void 0,void 0,(function(){return vr(this,(function(e){if(t.code!==br.FAILED_PRECONDITION||t.message!==ha)throw t;return _r("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}function au(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Rr(n,i);return 0===s?Rr(r,o):s}var uu=function(){function t(t){this.ne=t,this.buffer=new Ko(au),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();au(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),cu=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;_r("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(function(){return yr(e,void 0,void 0,(function(){var e;return vr(this,(function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return ga(e=n.sent())?(_r("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,su(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),hu=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return da.resolve(gr.o);var r=new uu(e);return this.ae.forEachTarget(t,(function(t){return r.re(t.sequenceNumber)})).next((function(){return n.ae.le(t,(function(t){return r.re(t)}))})).next((function(){return r.maxValue}))},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(_r("LruGarbageCollector","Garbage collection skipped; disabled"),da.resolve(Qa)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(_r("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Qa):n.fe(t,e)}))},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,s,a,u,c,h=this,l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return e>h.params.maximumSequenceNumbersToCollect?(_r("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+e),r=h.params.maximumSequenceNumbersToCollect):r=e,s=Date.now(),h.nthSequenceNumber(t,r)})).next((function(r){return n=r,a=Date.now(),h.removeTargets(t,n,e)})).next((function(e){return i=e,u=Date.now(),h.removeOrphanedDocuments(t,n)})).next((function(t){return c=Date.now(),Tr()<=o.in.DEBUG&&_r("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-l)+"ms\n\tDetermined least recently used "+r+" in "+(a-s)+"ms\n\tRemoved "+i+" targets in "+(u-a)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-l)+"ms"),da.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})}))},t}(),lu=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new hu(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.de=function(t){var e=0;return this.le(t,(function(t){e++})).next((function(){return e}))},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,(function(t,n){return e(n)}))},t.prototype.addReference=function(t,e,n){return fu(t,n)},t.prototype.removeReference=function(t,e,n){return fu(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return fu(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return tu(t).$t((function(r){return $a(t,r,e).next((function(t){return t&&(n=!0),da.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,(function(s,a){if(a<=e){var u=n._e(t,s).next((function(e){if(!e)return o++,r.getEntry(t,s).next((function(){return r.removeEntry(s),ou(t).delete([0,Ks(s.path)])}))}));i.push(u)}})).next((function(){return da.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return fu(t,e)},t.prototype.we=function(t,e){var n,r=ou(t),i=gr.o;return r.Ot({index:ra.documentTargetsIndex},(function(t,r){var o=t[0],s=(t[1],r.path),a=r.sequenceNumber;0===o?(i!==gr.o&&e(new ni(Qs(n)),i),i=a,n=s):i=gr.o})).next((function(){i!==gr.o&&e(new ni(Qs(n)),i)}))},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function fu(t,e){return ou(t).put(function(t,e){return new ra(0,Ks(t.path),e)}(e,t.currentSequenceNumber))}var du=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(this.equalsFn(s,t))return a}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Vr(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];t(s,a)}}))},t.prototype.isEmpty=function(){return Ur(this.inner)},t}(),pu=function(){function t(){this.changes=new du((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:Mr.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:gi.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?da.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),yu=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return gu(t).put(bu(e),n)},t.prototype.removeEntry=function(t,e){var n=gu(t),r=bu(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.me(t,r)}))},t.prototype.getEntry=function(t,e){var n=this;return gu(t).get(bu(e)).next((function(t){return n.ye(e,t)}))},t.prototype.ge=function(t,e){var n=this;return gu(t).get(bu(e)).next((function(t){return{document:n.ye(e,t),size:Ya(t)}}))},t.prototype.getEntries=function(t,e){var n=this,r=Qo();return this.pe(t,e,(function(t,e){var i=n.ye(t,e);r=r.insert(t,i)})).next((function(){return r}))},t.prototype.Ee=function(t,e){var n=this,r=Qo(),i=new qo(ni.comparator);return this.pe(t,e,(function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,Ya(e))})).next((function(){return{documents:r,Te:i}}))},t.prototype.pe=function(t,e,n){if(e.isEmpty())return da.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return gu(t).Ot({range:r},(function(t,e,r){for(var s=ni.fromSegments(t);o&&ni.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=Qo(),o=e.path.length+1,s={};if(n.isEqual(Mr.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=xa(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=ta.collectionReadTimeIndex}return gu(t).Ot(s,(function(t,n,s){if(t.length===o){var a=Ca(r.R,n);e.path.isPrefixOf(a.key.path)?Zi(e,a)&&(i=i.insert(a.key,a)):s.done()}})).next((function(){return i}))},t.prototype.newChangeBuffer=function(t){return new vu(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return mu(t).get(ea.key).next((function(t){return Nr(!!t),t}))},t.prototype.me=function(t,e){return mu(t).put(ea.key,e)},t.prototype.ye=function(t,e){if(e){var n=Ca(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(Mr.min()))return n}return gi.newInvalidDocument(t)},t}(),vu=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new du((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return pr(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Ko((function(t,e){return Rr(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=ka(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=Ya(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=ka(e.Ie.R,gi.newNoDocument(o,Mr.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))})),i.forEach((function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))})),n.push(this.Ie.updateMetadata(t,r)),da.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next((function(t){return n.Ae.set(e,t.size),t.document}))},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next((function(t){var e=t.documents;return t.Te.forEach((function(t,e){n.Ae.set(t,e)})),e}))},e}(pu);function mu(t){return Ea(t,ea.store)}function gu(t){return Ea(t,ta.store)}function bu(t){return t.path.toArray()}var wu=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;Nr(n<r&&n>=0&&r<=11);var o=new pa("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(Ws.store)}(t),function(t){t.createObjectStore(Ys.store,{keyPath:Ys.keyPath}),t.createObjectStore(Xs.store,{keyPath:Xs.keyPath,autoIncrement:!0}).createIndex(Xs.userMutationsIndex,Xs.userMutationsKeyPath,{unique:!0}),t.createObjectStore($s.store)}(t),Iu(t),function(t){t.createObjectStore(ta.store)}(t));var s=da.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(ra.store),t.deleteObjectStore(na.store),t.deleteObjectStore(ia.store)}(t),Iu(t)),s=s.next((function(){return function(t){var e=t.store(ia.store),n=new ia(0,0,Mr.min().toTimestamp(),0);return e.put(ia.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(Xs.store).Nt().next((function(n){t.deleteObjectStore(Xs.store),t.createObjectStore(Xs.store,{keyPath:Xs.keyPath,autoIncrement:!0}).createIndex(Xs.userMutationsIndex,Xs.userMutationsKeyPath,{unique:!0});var r=e.store(Xs.store),i=n.map((function(t){return r.put(t)}));return da.waitFor(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(sa.store,{keyPath:sa.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.Re(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(ea.store)}(t),i.be(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ve(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.Pe(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(ta.store);e.createIndex(ta.readTimeIndex,ta.readTimeIndexPath,{unique:!1}),e.createIndex(ta.collectionReadTimeIndex,ta.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.Ve(o)}))),n<11&&r>=11&&(s=s.next((function(){!function(t){t.createObjectStore(aa.store,{keyPath:aa.keyPath})}(t),function(t){t.createObjectStore(ua.store,{keyPath:ua.keyPath})}(t)}))),s},t.prototype.be=function(t){var e=0;return t.store(ta.store).Ot((function(t,n){e+=Ya(n)})).next((function(){var n=new ea(e);return t.store(ea.store).put(ea.key,n)}))},t.prototype.Re=function(t){var e=this,n=t.store(Ys.store),r=t.store(Xs.store);return n.Nt().next((function(n){return da.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(Xs.userMutationsIndex,i).next((function(r){return da.forEach(r,(function(r){Nr(r.userId===n.userId);var i=La(e.R,r);return Wa(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ve=function(t){var e=t.store(ra.store),n=t.store(ta.store);return t.store(ia.store).get(ia.key).next((function(t){var r=[];return n.Ot((function(n,i){var o=new Br(n),s=function(t){return[0,Ks(t)]}(o);r.push(e.get(s).next((function(n){return n?da.resolve():function(n){return e.put(new ra(0,Ks(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return da.waitFor(r)}))}))},t.prototype.Pe=function(t,e){t.createObjectStore(oa.store,{keyPath:oa.keyPath});var n=e.store(oa.store),r=new Ka,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:Ks(i)})}};return e.store(ta.store).Ot({kt:!0},(function(t,e){var n=new Br(t);return i(n.popLast())})).next((function(){return e.store($s.store).Ot({kt:!0},(function(t,e){t[0];var n=t[1],r=(t[2],Qs(n));return i(r.popLast())}))}))},t.prototype.Ve=function(t){var e=this,n=t.store(na.store);return n.Ot((function(t,r){var i=Ma(r),o=Fa(e.R,i);return n.put(o)}))},t}();function Iu(t){t.createObjectStore(ra.store,{keyPath:ra.keyPath}).createIndex(ra.documentTargetsIndex,ra.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(na.store,{keyPath:na.keyPath}).createIndex(na.queryTargetsIndexName,na.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(ia.store)}var Tu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",_u=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.Oe=null,this.$e=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new wr(br.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new lu(this,i),this.Le=n+"main",this.R=new Na(u),this.Be=new ya(this.Le,11,new wu(this.R)),this.qe=new nu(this.referenceDelegate,this.R),this.Ut=new Ga,this.Ue=function(t,e){return new yu(t,e)}(this.R,this.Ut),this.Qe=new Ua,this.window&&this.window.localStorage?this.Ke=this.window.localStorage:(this.Ke=null,!1===h&&Er("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new wr(br.FAILED_PRECONDITION,Tu);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.qe.getHighestSequenceNumber(e)}))})).then((function(e){t.Ne=new gr(e,t.De)})).then((function(){t.xe=!0})).catch((function(e){return t.Be&&t.Be.close(),Promise.reject(e)}))},t.prototype.He=function(t){var e=this;return this.Me=function(n){return yr(e,void 0,void 0,(function(){return vr(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt((function(n){return yr(e,void 0,void 0,(function(){return vr(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget((function(){return yr(e,void 0,void 0,(function(){return vr(this,(function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return Su(e).put(new sa(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.Je(e).next((function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable((function(){return t.Me(!1)})))}))})).next((function(){return t.Ye(e)})).next((function(n){return t.isPrimary&&!n?t.Xe(e).next((function(){return!1})):!!n&&t.Ze(e).next((function(){return!0}))}))})).catch((function(e){if(ga(e))return _r("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return _r("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Se.enqueueRetryable((function(){return t.Me(e)})),t.isPrimary=e}))},t.prototype.Je=function(t){var e=this;return Eu(t).get(Ws.key).next((function(t){return da.resolve(e.tn(t))}))},t.prototype.en=function(t){return Su(t).delete(this.clientId)},t.prototype.nn=function(){return yr(this,void 0,void 0,(function(){var t,e,n,r,i=this;return vr(this,(function(o){switch(o.label){case 0:return!this.isPrimary||this.sn(this.$e,18e5)?[3,2]:(this.$e=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=Ea(t,sa.store);return e.Nt().next((function(t){var n=i.rn(t,18e5),r=t.filter((function(t){return-1===n.indexOf(t)}));return da.forEach(r,(function(t){return e.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(t=o.sent(),this.Ke)for(e=0,n=t;e<n.length;e++)r=n[e],this.Ke.removeItem(this.on(r.clientId));o.label=2;case 2:return[2]}}))}))},t.prototype.ze=function(){var t=this;this.Oe=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return t.je().then((function(){return t.nn()})).then((function(){return t.ze()}))}))},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?da.resolve(!0):Eu(t).get(Ws.key).next((function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new wr(br.FAILED_PRECONDITION,Tu);return!1}}return!(!e.networkEnabled||!e.inForeground)||Su(t).Nt().next((function(t){return void 0===e.rn(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&_r("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.shutdown=function(){return yr(this,void 0,void 0,(function(){var t=this;return vr(this,(function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.Oe&&(this.Oe.cancel(),this.Oe=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Ws.store,sa.store],(function(e){var n=new _a(e,gr.o);return t.Xe(n).next((function(){return t.en(n)}))}))];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}}))}))},t.prototype.rn=function(t,e){var n=this;return t.filter((function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)}))},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return Su(e).Nt().next((function(e){return t.rn(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return Xa.Kt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;_r("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.Be.runTransaction(t,o,ca,(function(o){return i=new _a(o,r.Ne?r.Ne.next():gr.o),"readwrite-primary"===e?r.Je(i).next((function(t){return!!t||r.Ye(i)})).next((function(e){if(!e)throw Er("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.Se.enqueueRetryable((function(){return r.Me(!1)})),new wr(br.FAILED_PRECONDITION,ha);return n(i)})).next((function(t){return r.Ze(i).next((function(){return t}))})):r.dn(i).next((function(){return n(i)}))})).then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.dn=function(t){var e=this;return Eu(t).get(Ws.key).next((function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new wr(br.FAILED_PRECONDITION,Tu)}))},t.prototype.Ze=function(t){var e=new Ws(this.clientId,this.allowTabSynchronization,Date.now());return Eu(t).put(Ws.key,e)},t.yt=function(){return ya.yt()},t.prototype.Xe=function(t){var e=this,n=Eu(t);return n.get(Ws.key).next((function(t){return e.tn(t)?(_r("IndexedDbPersistence","Releasing primary lease."),n.delete(Ws.key)):da.resolve()}))},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(Er("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.je()}))},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),e.Se.enqueueAndForget((function(){return e.shutdown()}))},this.window.addEventListener("unload",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("unload",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Ke)||void 0===e?void 0:e.getItem(this.on(t)));return _r("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Er("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Ke)try{this.Ke.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Er("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Ke)try{this.Ke.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Eu(t){return Ea(t,Ws.store)}function Su(t){return Ea(t,sa.store)}function Au(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Du=function(t,e){this.progress=t,this.wn=e},Nu=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.yn(t,e,r)}))},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next((function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t}))},t.prototype.gn=function(t,e){t.forEach((function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)}))},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next((function(e){return n.En(t,e).next((function(){return e}))}))},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(t){return n.gn(e,t)}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return ni.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):Qi(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new ni(e)).next((function(t){var e=Wo();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=Wo();return this.Ut.getCollectionParents(t,i).next((function(s){return da.forEach(s,(function(s){var a=function(t,e){return new Ui(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return i=e,o.Rn(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=gi.newInvalidDocument(c),r=r.insert(c,h)),Eo(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}}))})).next((function(){return r.forEach((function(t,n){Zi(e,n)||(r=r.remove(t))})),r}))},t.prototype.Rn=function(t,e,n){for(var r=Jo(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Co&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next((function(t){return t.forEach((function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))})),c}))},t}(),Cu=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=Jo(),i=Jo(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),ku=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(Mr.min())?this.Dn(t,e):this.Sn.pn(t,r).next((function(s){var a=i.Cn(e,s);return(ji(e)||Ki(e))&&i.Nn(e.limitType,a,r,n)?i.Dn(t,e):(Tr()<=o.in.DEBUG&&_r("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Ji(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next((function(t){return a.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},t.prototype.Cn=function(t,e){var n=new Ko(to(t));return e.forEach((function(e,r){Zi(t,r)&&(n=n.add(r))})),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return Tr()<=o.in.DEBUG&&_r("QueryEngine","Using full collection scan to execute query:",Ji(e)),this.Sn.getDocumentsMatchingQuery(t,e,Mr.min())},t}(),xu=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new qo(Rr),this.kn=new du((function(t){return Ii(t)}),Ti),this.On=Mr.min(),this._n=t.getMutationQueue(n),this.$n=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Nu(this.$n,this._n,this.persistence.getIndexManager()),this.Qe=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.collect(n,e.Fn)}))},t}();function Ru(t,e,n,r){return new xu(t,e,n,r)}function Ou(t,e){return yr(this,void 0,void 0,(function(){var n,r,i,o;return vr(this,(function(s){switch(s.label){case 0:return n=Cr(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var o;return n._n.getAllMutationBatches(t).next((function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new Nu(n.$n,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)})).next((function(e){for(var n=[],r=[],s=Jo(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];s=s.add(f.key)}}for(var d=0,p=e;d<p.length;d++){var y=p[d];r.push(y.batchId);for(var v=0,m=y.mutations;v<m.length;v++){var g=m[v];s=s.add(g.key)}}return i.pn(t,s).next((function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}}))}))}))];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}}))}))}function Pu(t,e){var n=Cr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r=e.batch.keys(),i=n.$n.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=da.resolve();return o.forEach((function(t){s=s.next((function(){return r.getEntry(e,t)})).next((function(e){var o=n.docVersions.get(t);Nr(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))}))})),s.next((function(){return t._n.removeMutationBatch(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}function Lu(t){var e=Cr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.qe.getLastRemoteSnapshotVersion(t)}))}function Mu(t,e){var n=Cr(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.$n.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach((function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next((function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)})));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return Nr(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}}));var a=Qo();if(e.documentUpdates.forEach((function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),s.push(Fu(t,o,e.documentUpdates,r,void 0).next((function(t){a=t}))),!r.isEqual(Mr.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next((function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)}));s.push(u)}return da.waitFor(s).next((function(){return o.apply(t)})).next((function(){return n.Mn.En(t,a)})).next((function(){return a}))})).then((function(t){return n.Fn=i,t}))}function Fu(t,e,n,r,i){var o=Jo();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var o=Qo();return n.forEach((function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(Mr.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):_r("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)})),o}))}function Vu(t,e){var n=Cr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)}))}function Uu(t,e){var n=Cr(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.qe.getTargetData(t,e).next((function(i){return i?(r=i,da.resolve(r)):n.qe.allocateTargetId(t).next((function(i){return r=new Da(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t}))}function qu(t,e,n){return yr(this,void 0,void 0,(function(){var r,i,o,s;return vr(this,(function(a){switch(a.label){case 0:r=Cr(t),i=r.Fn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,(function(t){return r.persistence.referenceDelegate.removeTarget(t,i)}))];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!ga(s=a.sent()))throw s;return _r("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(i.target),[2]}}))}))}function Bu(t,e,n){var r=Cr(t),i=Mr.min(),o=Jo();return r.persistence.runTransaction("Execute query","readonly",(function(t){return function(t,e,n){var r=Cr(t),i=r.kn.get(n);return void 0!==i?da.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,Wi(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:Mr.min(),n?o:Jo())})).next((function(t){return{documents:t,Bn:o}}))}))}function ju(t,e){var n=Cr(t),r=Cr(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.lt(t,e).next((function(t){return t?t.target:null}))}))}function Ku(t){var e=Cr(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return function(t,e,n){var r=Cr(t),i=Qo(),o=xa(n),s=gu(e),a=IDBKeyRange.lowerBound(o,!0);return s.Ot({index:ta.readTimeIndex,range:a},(function(t,e){var n=Ca(r.R,e);i=i.insert(n.key,n),o=e.readTime})).next((function(){return{wn:i,readTime:Ra(o)}}))}(e.$n,t,e.On)})).then((function(t){var n=t.wn,r=t.readTime;return e.On=r,n}))}function Gu(t){return yr(this,void 0,void 0,(function(){var e;return vr(this,(function(n){return[2,(e=Cr(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return function(t){var e=gu(t),n=Mr.min();return e.Ot({index:ta.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=Ra(e.readTime)),r.done()})).next((function(){return n}))}(t)})).then((function(t){e.On=t}))]}))}))}function zu(t,e,n,r){return yr(this,void 0,void 0,(function(){var i,o,s,a,u,c,h,l,f,d;return vr(this,(function(p){switch(p.label){case 0:for(i=Cr(t),o=Jo(),s=Qo(),a=Xo(),u=0,c=n;u<c.length;u++)h=c[u],l=e.qn(h.metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,e.Un(h)),a=a.insert(l,e.Qn(h.metadata.readTime));return f=i.$n.newChangeBuffer({trackRemovals:!0}),[4,Uu(i,function(t){return Wi(Bi(Br.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",(function(t){return Fu(t,f,s,Mr.min(),a).next((function(e){return f.apply(t),e})).next((function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next((function(){return i.qe.addMatchingKeys(t,o,d.targetId)})).next((function(){return i.Mn.En(t,e)})).next((function(){return e}))}))}))]}}))}))}function Qu(t,e,n){return void 0===n&&(n=Jo()),yr(this,void 0,void 0,(function(){var r,i;return vr(this,(function(o){switch(o.label){case 0:return[4,Uu(t,Wi(Va(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=Cr(t)).persistence.runTransaction("Save named query","readwrite",(function(t){var o=vs(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Qe.saveNamedQuery(t,e);var s=r.withResumeToken(zr.EMPTY_BYTE_STRING,o);return i.Fn=i.Fn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next((function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)})).next((function(){return i.qe.addMatchingKeys(t,n,r.targetId)})).next((function(){return i.Qe.saveNamedQuery(t,e)}))}))]}}))}))}var Hu=function(){function t(t){this.R=t,this.Kn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return da.resolve(this.Kn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Kn.set(e.id,{id:(n=e).id,version:n.version,createTime:vs(n.createTime)}),da.resolve()},t.prototype.getNamedQuery=function(t,e){return da.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:Va(t.bundledQuery),readTime:vs(t.readTime)}}(e)),da.resolve()},t}(),Wu=function(){function t(){this.Wn=new Ko(Yu.Gn),this.zn=new Ko(Yu.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new Yu(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},t.prototype.removeReference=function(t,e){this.Yn(new Yu(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},t.prototype.Zn=function(t){var e=this,n=new ni(new Br([])),r=new Yu(n,t),i=new Yu(n,t+1),o=[];return this.zn.forEachInRange([r,i],(function(t){e.Yn(t),o.push(t.key)})),o},t.prototype.ts=function(){var t=this;this.Wn.forEach((function(e){return t.Yn(e)}))},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new ni(new Br([])),n=new Yu(e,t),r=new Yu(e,t+1),i=Jo();return this.zn.forEachInRange([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.containsKey=function(t){var e=new Yu(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Yu=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return ni.comparator(t.key,e.key)||Rr(t.ns,e.ns)},t.Hn=function(t,e){return Rr(t.ns,e.ns)||ni.comparator(t.key,e.key)},t}(),Xu=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Ko(Yu.Gn)}return t.prototype.checkEmpty=function(t){return da.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++,this._n.length>0&&this._n[this._n.length-1];var o=new Sa(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new Yu(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return da.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return da.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.cs(n),i=r<0?0:r;return da.resolve(this._n.length>i?this._n[i]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return da.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return da.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Yu(e,0),i=new Yu(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],(function(t){var e=n.os(t.ns);o.push(e)})),da.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Ko(Rr);return e.forEach((function(t){var e=new Yu(t,0),i=new Yu(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],(function(t){r=r.add(t.ns)}))})),da.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;ni.isDocumentKey(i)||(i=i.child(""));var o=new Yu(new ni(i),0),s=new Ko(Rr);return this.rs.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)}),o),da.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.os(t);null!==r&&n.push(r)})),n},t.prototype.removeMutationBatch=function(t,e){var n=this;Nr(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return da.forEach(e.mutations,(function(i){var o=new Yu(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((function(){n.rs=r}))},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new Yu(e,0),r=this.rs.firstAfterOrEqual(n);return da.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return this._n.length,da.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),$u=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new qo(ni.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return da.resolve(n?n.document.clone():gi.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=Qo();return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():gi.newInvalidDocument(t))})),da.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Qo(),i=new ni(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.key,u=s.value,c=u.document,h=u.readTime;if(!e.path.isPrefixOf(a.path))break;h.compareTo(n)<=0||Zi(e,c)&&(r=r.insert(c.key,c.clone()))}return da.resolve(r)},t.prototype.fs=function(t,e){return da.forEach(this.docs,(function(t){return e(t)}))},t.prototype.newChangeBuffer=function(t){return new Ju(this)},t.prototype.getSize=function(t){return da.resolve(this.size)},t}(),Ju=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return pr(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)})),da.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(pu),Zu=function(){function t(t){this.persistence=t,this.ds=new du((function(t){return Ii(t)}),Ti),this.lastRemoteSnapshotVersion=Mr.min(),this.highestTargetId=0,this.ws=0,this._s=new Wu,this.targetCount=0,this.ys=eu.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach((function(t,n){return e(n)})),da.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return da.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return da.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),da.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),da.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new eu(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,da.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),da.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,da.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach((function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)})),da.waitFor(o).next((function(){return i}))},t.prototype.getTargetCount=function(t){return da.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return da.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),da.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.markPotentiallyOrphaned(t,e))})),da.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),da.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return da.resolve(n)},t.prototype.containsKey=function(t,e){return da.resolve(this._s.containsKey(e))},t}(),tc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new gr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Zu(this),this.Ut=new ja,this.Ue=function(t,e){return new $u(t,(function(t){return n.referenceDelegate.ps(t)}))}(this.Ut),this.R=new Na(e),this.Qe=new Hu(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new Xu(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;_r("MemoryPersistence","Starting transaction:",t);var i=new ec(this.Ne.next());return this.referenceDelegate.Es(),n(i).next((function(t){return r.referenceDelegate.Ts(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.Is=function(t,e){return da.or(Object.values(this.gs).map((function(n){return function(){return n.containsKey(t,e)}})))},t}(),ec=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return pr(e,t),e}(la),nc=function(){function t(t){this.persistence=t,this.As=new Wu,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Dr()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),da.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),da.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),da.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach((function(t){return n.vs.add(t.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.vs.add(t.toString())}))})).next((function(){return r.removeTargetData(t,e)}))},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return da.forEach(this.vs,(function(r){var i=ni.fromPath(r);return e.Ps(t,i).next((function(t){t||n.removeEntry(i)}))})).next((function(){return e.Rs=null,n.apply(t)}))},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next((function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())}))},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return da.or([function(){return da.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),rc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function ic(t,e){return"firestore_clients_"+t+"_"+e}function oc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function sc(t,e){return"firestore_targets_"+t+"_"+e}rc.UNAUTHENTICATED=new rc(null),rc.GOOGLE_CREDENTIALS=new rc("google-credentials-uid"),rc.FIRST_PARTY=new rc("first-party-uid");var ac=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new wr(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(Er("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),uc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new wr(i.error.code,i.error.message)),o?new t(e,i.state,r):(Er("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),cc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=ts(),s=0;i&&s<r.activeTargetIds.length;++s)i=ei(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(Er("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),hc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(Er("SharedClientState","Failed to parse online state: "+e),null)},t}(),lc=function(){function t(){this.activeTargetIds=ts()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),fc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new qo(Rr),this.started=!1,this.Os=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.$s=ic(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new lc),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Qs=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return yr(this,void 0,void 0,(function(){var t,e,n,r,i,o,s,a,u,c,h,l=this;return vr(this,(function(f){switch(f.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=f.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(ic(this.persistenceKey,r)))&&(o=cc.Vs(r,i))&&(this.ks=this.ks.insert(o.clientId,o));for(this.Ks(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.Os;u<c.length;u++)h=c[u],this.Fs(h);return this.Os=[],this.window.addEventListener("unload",(function(){return l.shutdown()})),this.started=!0,[2]}}))}))},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(sc(this.persistenceKey,t));if(n){var r=uc.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Ks(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Ks()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(sc(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.Hs(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.$s),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return _r("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){_r("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){_r("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(_r("SharedClientState","EVENT",n.key,n.newValue),n.key===this.$s)return void Er("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable((function(){return yr(e,void 0,void 0,(function(){var t,e,r,i,o,s;return vr(this,(function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=gr.o;if(null!=t)try{var n=JSON.parse(t);Nr("number"==typeof n),e=n}catch(t){Er("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==gr.o&&this.sequenceNumberHandler(s);else if(n.key===this.Qs)return[2,this.syncEngine.ci()]}else this.Os.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Ks=function(){this.setItem(this.$s,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new ac(this.currentUser,t,e,n),i=oc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=oc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){var e={clientId:this.Ns,onlineState:t};this.storage.setItem(this.Us,JSON.stringify(e))},t.prototype.Ys=function(t,e,n){var r=sc(this.persistenceKey,t),i=new uc(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Qs,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return cc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return ac.Vs(new rc(i),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return uc.Vs(r,e)},t.prototype.js=function(t){return hc.Vs(t)},t.prototype.ii=function(t){return yr(this,void 0,void 0,(function(){return vr(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(_r("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||a.push(t)})),this.syncEngine.hi(s,a).then((function(){n.ks=r}))},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=ts();return t.forEach((function(t,n){e=e.unionWith(n.activeTargetIds)})),e},t}(),dc=function(){function t(){this.li=new lc,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new lc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),pc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),yc=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){_r("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){_r("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),vc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},mc=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),gc=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n}return pr(e,t),e.prototype.ki=function(t,e,n,r){return new Promise((function(i,o){var s=new fr;s.listenOnce(ur.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case ar.NO_ERROR:var e=s.getResponseJson();_r("Connection","XHR received:",JSON.stringify(e)),i(e);break;case ar.TIMEOUT:_r("Connection",'RPC "'+t+'" timed out'),o(new wr(br.DEADLINE_EXCEEDED,"Request time out"));break;case ar.HTTP_ERROR:var n=s.getStatus();if(_r("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(br).indexOf(e)>=0?e:br.UNKNOWN}(r.status);o(new wr(a,r.message))}else o(new wr(br.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new wr(br.UNAVAILABLE,"Connection failed."));break;default:Dr()}}finally{_r("Connection",'RPC "'+t+'" completed.')}}));var a=JSON.stringify(r);s.send(e,"POST",a,n,15)}))},e.prototype.$i=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=or(),o=sr(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.Fi(s.initMessageHeaders,e),(0,i.uI)()||(0,i.b$)()||(0,i.d)()||(0,i.w1)()||(0,i.Mn)()||(0,i.ru)()||(s.httpHeadersOverwriteParam="$httpHeaders");var a=n.join("");_r("Connection","Creating WebChannel: "+a,s);var u=r.createWebChannel(a,s),c=!1,h=!1,l=new mc({Ei:function(t){h?_r("Connection","Not sending because WebChannel is closed:",t):(c||(_r("Connection","Opening WebChannel transport."),u.open(),c=!0),_r("Connection","WebChannel sending:",t),u.send(t))},Ti:function(){return u.close()}}),f=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return f(u,lr.EventType.OPEN,(function(){h||_r("Connection","WebChannel transport opened.")})),f(u,lr.EventType.CLOSE,(function(){h||(h=!0,_r("Connection","WebChannel transport closed"),l.Vi())})),f(u,lr.EventType.ERROR,(function(t){h||(h=!0,Sr("Connection","WebChannel transport errored:",t),l.Vi(new wr(br.UNAVAILABLE,"The operation could not be completed")))})),f(u,lr.EventType.MESSAGE,(function(t){var e;if(!h){var n=t.data[0];Nr(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){_r("Connection","WebChannel received error:",i);var o=i.status,s=function(t){var e=Oo[t];if(void 0!==e)return Uo(e)}(o),a=i.message;void 0===s&&(s=br.INTERNAL,a="Unknown error status: "+o+" with message "+i.message),h=!0,l.Vi(new wr(s,a)),u.close()}else _r("Connection","WebChannel received:",n),l.Si(n)}})),f(o,cr.STAT_EVENT,(function(t){t.stat===hr.PROXY?_r("Connection","Detected buffering proxy"):t.stat===hr.NOPROXY&&_r("Connection","Detected no buffering proxy")})),setTimeout((function(){l.Pi()}),0),l},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);_r("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then((function(t){return _r("RestConnection","Received: ",t),t}),(function(e){throw Sr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.Oi=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.3.3",t["X-Firebase-GMPID"]=this.databaseInfo.appId,t["Content-Type"]="text/plain",e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){var n=vc[t];return this.Di+"/v1/"+e+":"+n},t}());function bc(){return"undefined"!=typeof window?window:null}function wc(){return"undefined"!=typeof document?document:null}function Ic(t){return new fs(t,!0)}var Tc=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Qi=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Ki=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Qi),i=Math.max(0,n-r);i>0&&_r("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,(function(){return e.Qi=Date.now(),t()})),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),_c=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Tc(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return yr(this,void 0,void 0,(function(){return vr(this,(function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,(function(){return t.rr()})))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return yr(this,void 0,void 0,(function(){return vr(this,(function(t){return this.er()?[2,this.close(0)]:[2]}))}))},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return yr(this,void 0,void 0,(function(){return vr(this,(function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===br.RESOURCE_EXHAUSTED?(Er(e.toString()),Er("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Ki()):e&&e.code===br.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then((function(e){t.Yi===n&&t.lr(e)}),(function(n){e((function(){var e=new wr(br.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)}))}))},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii((function(){n((function(){return e.state=2,e.listener.Ii()}))})),this.stream.Ri((function(t){n((function(){return e.dr(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji((function(){return yr(t,void 0,void 0,(function(){return vr(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.dr=function(t){return _r("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget((function(){return e.Yi===t?n():(_r("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),Ec=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return pr(e,t),e.prototype.wr=function(t){return this.Hi.$i("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Dr()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(Nr(void 0===e||"string"==typeof e),zr.fromBase64String(e||"")):(Nr(void 0===e||e instanceof Uint8Array),zr.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?br.UNKNOWN:Uo(t.code);return new wr(e,t.message||"")}(a);n=new os(r,i,o,s||null)}else if("documentChange"in e){e.documentChange,(r=e.documentChange).document,r.document.name,r.document.updateTime,i=ws(t,r.document.name),o=vs(r.document.updateTime);var a=new vi({mapValue:{fields:r.document.fields}}),u=(s=gi.newFoundDocument(i,o,a),r.targetIds||[]),c=r.removedTargetIds||[];n=new rs(u,c,s.key,s)}else if("documentDelete"in e)e.documentDelete,(r=e.documentDelete).document,i=ws(t,r.document),o=r.readTime?vs(r.readTime):Mr.min(),a=gi.newNoDocument(i,o),s=r.removedTargetIds||[],n=new rs([],s,a.key,a);else if("documentRemove"in e)e.documentRemove,(r=e.documentRemove).document,i=ws(t,r.document),o=r.removedTargetIds||[],n=new rs([],o,i,null);else{if(!("filter"in e))return Dr();e.filter;var h=e.filter;h.targetId,r=h.count||0,i=new Fo(r),o=h.targetId,n=new is(o,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return Mr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?Mr.min():e.readTime?vs(e.readTime):Mr.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=_s(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=_i(r)?{documents:Cs(t,r)}:{query:ks(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=ps(t,e.resumeToken):e.snapshotVersion.compareTo(Mr.min())>0&&(n.readTime=ds(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Dr()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.R,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=_s(this.R),e.removeTarget=t,this.cr(e)},e}(_c),Sc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return pr(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.$i("Write",t)},e.prototype.onMessage=function(t){if(Nr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(Nr(void 0!==e),t.map((function(t){return function(t,e){var n=t.updateTime?vs(t.updateTime):vs(e);return n.isEqual(Mr.min())&&(n=vs(e)),new bo(n,t.transformResults||[])}(t,e)}))):[]}(t.writeResults,t.commitTime),n=vs(t.commitTime);return this.listener.Tr(n,e)}return Nr(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=_s(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return Ds(e.R,t)}))};this.cr(n)},e}(_c),Ac=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return pr(e,t),e.prototype.br=function(){if(this.Rr)throw new wr(br.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Ni(t,e,n,i)})).catch((function(t){throw t.code===br.UNAUTHENTICATED&&r.credentials.invalidateToken(),t}))},e.prototype.Oi=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Oi(t,e,n,i)})).catch((function(t){throw t.code===br.UNAUTHENTICATED&&r.credentials.invalidateToken(),t}))},e.prototype.terminate=function(){this.Rr=!1},e}((function(){})),Dc=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()})))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(Er(e),this.Vr=!1):_r("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),Nc=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.Or=new Map,this.$r=new Set,this.Mr=[],this.Lr=i,this.Lr.di((function(t){n.enqueueAndForget((function(){return yr(o,void 0,void 0,(function(){return vr(this,(function(t){switch(t.label){case 0:return Fc(this)?(_r("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return yr(this,void 0,void 0,(function(){var e;return vr(this,(function(n){switch(n.label){case 0:return(e=Cr(t)).$r.add(4),[4,kc(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.$r.delete(4),[4,Cc(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Br=new Dc(n,r)};function Cc(t){return yr(this,void 0,void 0,(function(){var e,n;return vr(this,(function(r){switch(r.label){case 0:if(!Fc(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function kc(t){return yr(this,void 0,void 0,(function(){var e,n;return vr(this,(function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function xc(t,e){var n=Cr(t);n.Or.has(e.targetId)||(n.Or.set(e.targetId,e),Mc(n)?Lc(n):Jc(n).er()&&Oc(n,e))}function Rc(t,e){var n=Cr(t),r=Jc(n);n.Or.delete(e),r.er()&&Pc(n,e),0===n.Or.size&&(r.er()?r.ir():Fc(n)&&n.Br.set("Unknown"))}function Oc(t,e){t.qr.U(e.targetId),Jc(t).mr(e)}function Pc(t,e){t.qr.U(e),Jc(t).yr(e)}function Lc(t){t.qr=new as({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.Or.get(e)||null}}),Jc(t).start(),t.Br.Sr()}function Mc(t){return Fc(t)&&!Jc(t).tr()&&t.Or.size>0}function Fc(t){return 0===Cr(t).$r.size}function Vc(t){t.qr=void 0}function Uc(t){return yr(this,void 0,void 0,(function(){return vr(this,(function(e){return t.Or.forEach((function(e,n){Oc(t,e)})),[2]}))}))}function qc(t,e){return yr(this,void 0,void 0,(function(){return vr(this,(function(n){return Vc(t),Mc(t)?(t.Br.Nr(e),Lc(t)):t.Br.set("Unknown"),[2]}))}))}function Bc(t,e,n){return yr(this,void 0,void 0,(function(){var r,i,o;return vr(this,(function(s){switch(s.label){case 0:if(t.Br.set("Online"),!(e instanceof os&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return yr(this,void 0,void 0,(function(){var n,r,i,o;return vr(this,(function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?(o=i[r],t.Or.has(o)?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]):[3,5];case 2:s.sent(),t.Or.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),_r("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,jc(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof rs?t.qr.X(e):e instanceof is?t.qr.rt(e):t.qr.et(e),n.isEqual(Mr.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,Lu(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.Or.get(r);i&&t.Or.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((function(e){var n=t.Or.get(e);if(n){t.Or.set(e,n.withResumeToken(zr.EMPTY_BYTE_STRING,n.snapshotVersion)),Pc(t,e);var r=new Da(n.target,e,1,n.sequenceNumber);Oc(t,r)}})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return _r("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,jc(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}}))}))}function jc(t,e,n){return yr(this,void 0,void 0,(function(){var r=this;return vr(this,(function(i){switch(i.label){case 0:if(!ga(e))throw e;return t.$r.add(1),[4,kc(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return Lu(t.localStore)}),t.asyncQueue.enqueueRetryable((function(){return yr(r,void 0,void 0,(function(){return vr(this,(function(e){switch(e.label){case 0:return _r("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.$r.delete(1),[4,Cc(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function Kc(t,e){return e().catch((function(n){return jc(t,n,e)}))}function Gc(t){return yr(this,void 0,void 0,(function(){var e,n,r,i,o;return vr(this,(function(s){switch(s.label){case 0:e=Cr(t),n=Zc(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return Fc(t)&&t.kr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,Vu(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.kr.push(e);var n=Zc(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,jc(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return zc(e)&&Qc(e),[2]}}))}))}function zc(t){return Fc(t)&&!Zc(t).tr()&&t.kr.length>0}function Qc(t){Zc(t).start()}function Hc(t){return yr(this,void 0,void 0,(function(){return vr(this,(function(e){return Zc(t).Ar(),[2]}))}))}function Wc(t){return yr(this,void 0,void 0,(function(){var e,n,r,i;return vr(this,(function(o){for(e=Zc(t),n=0,r=t.kr;n<r.length;n++)i=r[n],e.Er(i.mutations);return[2]}))}))}function Yc(t,e,n){return yr(this,void 0,void 0,(function(){var r,i;return vr(this,(function(o){switch(o.label){case 0:return r=t.kr.shift(),i=Aa.from(r,e,n),[4,Kc(t,(function(){return t.remoteSyncer.applySuccessfulWrite(i)}))];case 1:return o.sent(),[4,Gc(t)];case 2:return o.sent(),[2]}}))}))}function Xc(t,e){return yr(this,void 0,void 0,(function(){return vr(this,(function(n){switch(n.label){case 0:return e&&Zc(t).pr?[4,function(t,e){return yr(this,void 0,void 0,(function(){var n,r;return vr(this,(function(i){switch(i.label){case 0:return Vo(r=e.code)&&r!==br.ABORTED?(n=t.kr.shift(),Zc(t).sr(),[4,Kc(t,(function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)}))]):[3,3];case 1:return i.sent(),[4,Gc(t)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return zc(t)&&Qc(t),[2]}}))}))}function $c(t,e){return yr(this,void 0,void 0,(function(){var n;return vr(this,(function(r){switch(r.label){case 0:return n=Cr(t),e?(n.$r.delete(2),[4,Cc(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.$r.add(2),[4,kc(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function Jc(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=Cr(t);return r.br(),new Ec(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Uc.bind(null,t),Ri:qc.bind(null,t),_r:Bc.bind(null,t)}),t.Mr.push((function(n){return yr(e,void 0,void 0,(function(){return vr(this,(function(e){switch(e.label){case 0:return n?(t.Ur.sr(),Mc(t)?Lc(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),Vc(t),e.label=3;case 3:return[2]}}))}))}))),t.Ur}function Zc(t){var e=this;return t.Qr||(t.Qr=function(t,e,n){var r=Cr(t);return r.br(),new Sc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Hc.bind(null,t),Ri:Xc.bind(null,t),Ir:Wc.bind(null,t),Tr:Yc.bind(null,t)}),t.Mr.push((function(n){return yr(e,void 0,void 0,(function(){return vr(this,(function(e){switch(e.label){case 0:return n?(t.Qr.sr(),[4,Gc(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Qr.stop()];case 3:e.sent(),t.kr.length>0&&(_r("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),e.label=4;case 4:return[2]}}))}))}))),t.Qr}var th=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new fa,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new wr(br.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function eh(t,e){if(Er("AsyncQueue",e+": "+t),ga(t))return new wr(br.UNAVAILABLE,e+": "+t);throw t}var nh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||ni.comparator(e.key,n.key)}:function(t,e){return ni.comparator(t.key,e.key)},this.keyedMap=Wo(),this.sortedSet=new qo(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),rh=function(){function t(){this.Kr=new qo(ni.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Kr.get(e);n?0!==t.type&&3===n.type?this.Kr=this.Kr.insert(e,t):3===t.type&&1!==n.type?this.Kr=this.Kr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Kr=this.Kr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Kr=this.Kr.remove(e):1===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):Dr():this.Kr=this.Kr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Kr.inorderTraversal((function(e,n){t.push(n)})),t},t}(),ih=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,nh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Xi(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),oh=function(){this.Wr=void 0,this.listeners=[]},sh=function(){this.queries=new du((function(t){return $i(t)}),Xi),this.onlineState="Unknown",this.Gr=new Set};function ah(t,e){return yr(this,void 0,void 0,(function(){var n,r,i,o,s,a,u;return vr(this,(function(c){switch(c.label){case 0:if(n=Cr(t),r=e.query,i=!1,(o=n.queries.get(r))||(i=!0,o=new oh),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=eh(a,"Initialization of query '"+Ji(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&lh(n),[2]}}))}))}function uh(t,e){return yr(this,void 0,void 0,(function(){var n,r,i,o,s;return vr(this,(function(a){return n=Cr(t),r=e.query,i=!1,(o=n.queries.get(r))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]}))}))}function ch(t,e){for(var n=Cr(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query,u=n.queries.get(a);if(u){for(var c=0,h=u.listeners;c<h.length;c++)h[c].Hr(s)&&(r=!0);u.Wr=s}}r&&lh(n)}function hh(t,e,n){var r=Cr(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function lh(t){t.Gr.forEach((function(t){t.next()}))}var fh=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new ih(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.so&&n||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){if(t.docChanges.length>0)return!0;var e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=ih.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),dh=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),ph=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return ws(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?As(this.R,t.document,!1):gi.newNoDocument(this.qn(t.metadata.name),this.Qn(t.metadata.readTime))},t.prototype.Qn=function(t){return vs(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=yh(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new ph(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||Jo()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return yr(this,void 0,void 0,(function(){var t,e,n,r,i;return vr(this,(function(o){switch(o.label){case 0:return[4,zu(this.localStore,new ph(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?(i=r[n],[4,Qu(this.localStore,i,e.get(i.name))]):[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new Du(Object.assign({},this.progress),t))]}}))}))}}();function yh(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var vh=function(t){this.key=t},mh=function(t){this.key=t},gh=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=Jo(),this.mutatedKeys=Jo(),this.lo=to(t),this.fo=new nh(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new rh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=ji(this.query)&&i.size===this.query.limit?i.last():null,c=Ki(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var h=i.get(t),l=Zi(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),ji(this.query)||Ki(this.query))for(;s.size>this.query.limit;){var h=ji(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Dr()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)})),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new ih(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new rh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e.uo=e.uo.add(t)})),t.modifiedDocuments.forEach((function(t){})),t.removedDocuments.forEach((function(t){return e.uo=e.uo.delete(t)})),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=Jo(),this.fo.forEach((function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))}));var n=[];return e.forEach((function(e){t.ho.has(e)||n.push(new mh(e))})),this.ho.forEach((function(t){e.has(t)||n.push(new vh(t))})),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=Jo();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return ih.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),bh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},wh=function(t){this.key=t,this.bo=!1},Ih=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new du((function(t){return $i(t)}),Xi),this.Vo=new Map,this.So=new Set,this.Do=new qo(ni.comparator),this.Co=new Map,this.No=new Wu,this.xo={},this.Fo=new Map,this.ko=eu.Yt(),this.onlineState="Unknown",this.Oo=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.Oo},enumerable:!1,configurable:!0}),t}();function Th(t,e){return yr(this,void 0,void 0,(function(){var n,r,i,o,s,a;return vr(this,(function(u){switch(u.label){case 0:return n=$h(t),(o=n.Po.get(e))?(r=o.targetId,n.sharedClientState.addLocalQueryTarget(r),i=o.view.Ro(),[3,4]):[3,1];case 1:return[4,Uu(n.localStore,Wi(e))];case 2:return s=u.sent(),a=n.sharedClientState.addLocalQueryTarget(s.targetId),r=s.targetId,[4,_h(n,e,r,"current"===a)];case 3:i=u.sent(),n.isPrimaryClient&&xc(n.remoteStore,s),u.label=4;case 4:return[2,i]}}))}))}function _h(t,e,n,r){return yr(this,void 0,void 0,(function(){var i,o,s,a,u,c;return vr(this,(function(h){switch(h.label){case 0:return t.$o=function(e,n,r){return function(t,e,n,r){return yr(this,void 0,void 0,(function(){var i,o,s;return vr(this,(function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,Bu(t.localStore,e.query,!1).then((function(t){var n=t.documents;return e.view._o(n,i)}))]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(Mh(t,e.targetId,s.To),s.snapshot)]}}))}))}(t,e,n,r)},[4,Bu(t.localStore,e,!0)];case 1:return i=h.sent(),o=new gh(e,i.Bn),s=o._o(i.documents),a=ns.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(s,t.isPrimaryClient,a),Mh(t,n,u.To),c=new bh(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}}))}))}function Eh(t,e){return yr(this,void 0,void 0,(function(){var n,r,i;return vr(this,(function(o){switch(o.label){case 0:return n=Cr(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter((function(t){return!Xi(t,e)}))),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,qu(n.localStore,r.targetId,!1).then((function(){n.sharedClientState.clearQueryState(r.targetId),Rc(n.remoteStore,r.targetId),Ph(n,r.targetId)})).catch(su)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return Ph(n,r.targetId),[4,qu(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))}function Sh(t,e,n){return yr(this,void 0,void 0,(function(){var r,i,o,s;return vr(this,(function(a){switch(a.label){case 0:r=Jh(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=Cr(t),i=Lr.now(),o=e.reduce((function(t,e){return t.add(e.key)}),Jo());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return r.Mn.pn(t,o).next((function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=So(c,n.get(c.key));null!=h&&s.push(new Co(c.key,h,mi(h.toProto().mapValue),wo.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)}))})).then((function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}}))}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new qo(Rr)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,Uh(r,i.changes)];case 3:return a.sent(),[4,Gc(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=eh(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}}))}))}function Ah(t,e){return yr(this,void 0,void 0,(function(){var n,r;return vr(this,(function(i){switch(i.label){case 0:n=Cr(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Mu(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach((function(t,e){var r=n.Co.get(e);r&&(Nr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?Nr(r.bo):t.removedDocuments.size>0&&(Nr(r.bo),r.bo=!1))})),[4,Uh(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,su(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function Dh(t,e,n){var r=Cr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach((function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=Cr(t);n.onlineState=e;var r=!1;n.queries.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)})),r&&lh(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Nh(t,e,n){return yr(this,void 0,void 0,(function(){var r,i,o,s,a,u;return vr(this,(function(c){switch(c.label){case 0:return(r=Cr(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new qo(ni.comparator)).insert(o,gi.newNoDocument(o,Mr.min())),a=Jo().add(o),u=new es(Mr.min(),new Map,new Ko(Rr),s,a),[4,Ah(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),Vh(r),[3,4];case 2:return[4,qu(r.localStore,e,!1).then((function(){return Ph(r,e,n)})).catch(su)];case 3:c.sent(),c.label=4;case 4:return[2]}}))}))}function Ch(t,e){return yr(this,void 0,void 0,(function(){var n,r,i;return vr(this,(function(o){switch(o.label){case 0:n=Cr(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,Pu(n.localStore,e)];case 2:return i=o.sent(),Oh(n,r,null),Rh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,Uh(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,su(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function kh(t,e,n){return yr(this,void 0,void 0,(function(){var r,i;return vr(this,(function(o){switch(o.label){case 0:r=Cr(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=Cr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var r;return n._n.lookupMutationBatch(t,e).next((function(e){return Nr(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}(r.localStore,e)];case 2:return i=o.sent(),Oh(r,e,n),Rh(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,Uh(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,su(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function xh(t,e){return yr(this,void 0,void 0,(function(){var n,r,i,o,s;return vr(this,(function(a){switch(a.label){case 0:Fc((n=Cr(t)).remoteStore)||_r("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=Cr(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e._n.getHighestUnacknowledgedBatchId(t)}))}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.Fo.get(r)||[]).push(e),n.Fo.set(r,i),[3,4]);case 3:return o=a.sent(),s=eh(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}}))}))}function Rh(t,e){(t.Fo.get(e)||[]).forEach((function(t){t.resolve()})),t.Fo.delete(e)}function Oh(t,e,n){var r=Cr(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function Ph(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach((function(e){t.No.containsKey(e)||Lh(t,e)}))}function Lh(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Rc(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Vh(t))}function Mh(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof vh?(t.No.addReference(o.key,e),Fh(t,o)):o instanceof mh?(_r("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||Lh(t,o.key)):Dr()}}function Fh(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(_r("SyncEngine","New document in limbo: "+n),t.So.add(r),Vh(t))}function Vh(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new ni(Br.fromString(e)),r=t.ko.next();t.Co.set(r,new wh(n)),t.Do=t.Do.insert(n,r),xc(t.remoteStore,new Da(Wi(Bi(n.path)),r,2,gr.o))}}function Uh(t,e,n){return yr(this,void 0,void 0,(function(){var r,i,o,s;return vr(this,(function(a){switch(a.label){case 0:return r=Cr(t),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach((function(t,a){s.push(r.$o(a,e,n).then((function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=Cu.Pn(a.targetId,t);o.push(e)}})))})),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return yr(this,void 0,void 0,(function(){var n,r,i,o,s,a,u,c,h;return vr(this,(function(l){switch(l.label){case 0:n=Cr(t),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return da.forEach(e,(function(e){return da.forEach(e.bn,(function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)})).next((function(){return da.forEach(e.vn,(function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)}))}))}))}))];case 2:return l.sent(),[3,4];case 3:if(!ga(r=l.sent()))throw r;return _r("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)s=o[i],a=s.targetId,s.fromCache||(u=n.Fn.get(a),c=u.snapshotVersion,h=u.withLastLimboFreeSnapshotVersion(c),n.Fn=n.Fn.insert(a,h));return[2]}}))}))}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}}))}))}function qh(t,e){return yr(this,void 0,void 0,(function(){var n,r;return vr(this,(function(i){switch(i.label){case 0:return(n=Cr(t)).currentUser.isEqual(e)?[3,3]:(_r("SyncEngine","User change. New user:",e.toKey()),[4,Ou(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Fo.forEach((function(t){t.forEach((function(t){t.reject(new wr(br.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Fo.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,Uh(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}function Bh(t,e){var n=Cr(t),r=n.Co.get(e);if(r&&r.bo)return Jo().add(r.key);var i=Jo(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=a[s],c=n.Po.get(u);i=i.unionWith(c.view.wo)}return i}function jh(t,e){return yr(this,void 0,void 0,(function(){var n,r,i;return vr(this,(function(o){switch(o.label){case 0:return[4,Bu((n=Cr(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&Mh(n,e.targetId,i.To),i)]}}))}))}function Kh(t){return yr(this,void 0,void 0,(function(){var e;return vr(this,(function(n){return[2,Ku((e=Cr(t)).localStore).then((function(t){return Uh(e,t)}))]}))}))}function Gh(t,e,n,r){return yr(this,void 0,void 0,(function(){var i,o;return vr(this,(function(s){switch(s.label){case 0:return[4,function(t,e){var n=Cr(t),r=Cr(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.jt(t,e).next((function(e){return e?n.Mn.pn(t,e):da.resolve(null)}))}))}((i=Cr(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,Gc(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Oh(i,e,r||null),Rh(i,e),function(t,e){Cr(Cr(t)._n).Gt(e)}(i.localStore,e)):Dr(),s.label=4;case 4:return[4,Uh(i,o)];case 5:return s.sent(),[3,7];case 6:_r("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}}))}))}function zh(t,e){return yr(this,void 0,void 0,(function(){var n,r,i,o,s,a,u,c;return vr(this,(function(h){switch(h.label){case 0:return $h(n=Cr(t)),Jh(n),!0!==e||!0===n.Oo?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,Qh(n,r.toArray())]);case 1:return i=h.sent(),n.Oo=!0,[4,$c(n.remoteStore,!0)];case 2:for(h.sent(),o=0,s=i;o<s.length;o++)a=s[o],xc(n.remoteStore,a);return[3,7];case 3:return!1!==e||!1===n.Oo?[3,7]:(u=[],c=Promise.resolve(),n.Vo.forEach((function(t,e){n.sharedClientState.isLocalQueryTarget(e)?u.push(e):c=c.then((function(){return Ph(n,e),qu(n.localStore,e,!0)})),Rc(n.remoteStore,e)})),[4,c]);case 4:return h.sent(),[4,Qh(n,u)];case 5:return h.sent(),function(t){var e=Cr(t);e.Co.forEach((function(t,n){Rc(e.remoteStore,n)})),e.No.ts(),e.Co=new Map,e.Do=new qo(ni.comparator)}(n),n.Oo=!1,[4,$c(n.remoteStore,!1)];case 6:h.sent(),h.label=7;case 7:return[2]}}))}))}function Qh(t,e,n){return yr(this,void 0,void 0,(function(){var n,r,i,o,s,a,u,c,h,l,f,d,p,y;return vr(this,(function(v){switch(v.label){case 0:n=Cr(t),r=[],i=[],o=0,s=e,v.label=1;case 1:return o<s.length?(a=s[o],u=void 0,(c=n.Vo.get(a))&&0!==c.length?[4,Uu(n.localStore,Wi(c[0]))]:[3,7]):[3,13];case 2:u=v.sent(),h=0,l=c,v.label=3;case 3:return h<l.length?(f=l[h],d=n.Po.get(f),[4,jh(n,d)]):[3,6];case 4:(p=v.sent()).snapshot&&i.push(p.snapshot),v.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,ju(n.localStore,a)];case 8:return y=v.sent(),[4,Uu(n.localStore,y)];case 9:return u=v.sent(),[4,_h(n,Hh(y),a,!1)];case 10:v.sent(),v.label=11;case 11:r.push(u),v.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}}))}))}function Hh(t){return qi(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Wh(t){var e=Cr(t);return Cr(Cr(e.localStore).persistence).fn()}function Yh(t,e,n,r){return yr(this,void 0,void 0,(function(){var i,o,s;return vr(this,(function(a){switch(a.label){case 0:return(i=Cr(t)).Oo?(_r("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Ku(i.localStore)];case 3:return o=a.sent(),s=es.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,Uh(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,qu(i.localStore,e,!0)];case 6:return a.sent(),Ph(i,e,r),[3,8];case 7:Dr(),a.label=8;case 8:return[2]}}))}))}function Xh(t,e,n){return yr(this,void 0,void 0,(function(){var r,i,o,s,a,u,c,h,l,f;return vr(this,(function(d){switch(d.label){case 0:if(!(r=$h(t)).Oo)return[3,10];i=0,o=e,d.label=1;case 1:return i<o.length?(s=o[i],r.Vo.has(s)?(_r("SyncEngine","Adding an already active target "+s),[3,5]):[4,ju(r.localStore,s)]):[3,6];case 2:return a=d.sent(),[4,Uu(r.localStore,a)];case 3:return u=d.sent(),[4,_h(r,Hh(a),u.targetId,!1)];case 4:d.sent(),xc(r.remoteStore,u),d.label=5;case 5:return i++,[3,1];case 6:c=function(t){return vr(this,(function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,qu(r.localStore,t,!1).then((function(){Rc(r.remoteStore,t),Ph(r,t)})).catch(su)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},h=0,l=n,d.label=7;case 7:return h<l.length?(f=l[h],[5,c(f)]):[3,10];case 8:d.sent(),d.label=9;case 9:return h++,[3,7];case 10:return[2]}}))}))}function $h(t){var e=Cr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ah.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Bh.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Nh.bind(null,e),e.vo._r=ch.bind(null,e.eventManager),e.vo.Mo=hh.bind(null,e.eventManager),e}function Jh(t){var e=Cr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Ch.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=kh.bind(null,e),e}var Zh=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return yr(this,void 0,void 0,(function(){return vr(this,(function(e){switch(e.label){case 0:return this.R=Ic(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Qo(t),[2]}}))}))},t.prototype.Uo=function(t){return null},t.prototype.Qo=function(t){return Ru(this.persistence,new ku,t.initialUser,this.R)},t.prototype.qo=function(t){return new tc(nc.bs,this.R)},t.prototype.Bo=function(t){return new dc},t.prototype.terminate=function(){return yr(this,void 0,void 0,(function(){return vr(this,(function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}}))}))},t}(),tl=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Ko=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return pr(e,t),e.prototype.initialize=function(e){return yr(this,void 0,void 0,(function(){return vr(this,(function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,Gu(this.localStore)];case 2:return n.sent(),[4,this.Ko.initialize(this,e)];case 3:return n.sent(),[4,Jh(this.Ko.syncEngine)];case 4:return n.sent(),[4,Gc(this.Ko.remoteStore)];case 5:return n.sent(),[2]}}))}))},e.prototype.Qo=function(t){return Ru(this.persistence,new ku,t.initialUser,this.R)},e.prototype.Uo=function(t){var e=this.persistence.referenceDelegate.garbageCollector;return new cu(e,t.asyncQueue)},e.prototype.qo=function(t){var e=Au(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Ha.withCacheSize(this.cacheSizeBytes):Ha.DEFAULT;return new _u(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,bc(),wc(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new dc},e}(Zh),el=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Ko=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return pr(e,t),e.prototype.initialize=function(e){return yr(this,void 0,void 0,(function(){var n,r=this;return vr(this,(function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Ko.syncEngine,this.sharedClientState instanceof fc?(this.sharedClientState.syncEngine={ui:Gh.bind(null,n),ai:Yh.bind(null,n),hi:Xh.bind(null,n),fn:Wh.bind(null,n),ci:Kh.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He((function(t){return yr(r,void 0,void 0,(function(){return vr(this,(function(e){switch(e.label){case 0:return[4,zh(this.Ko.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}}))}))}))];case 4:return i.sent(),[2]}}))}))},e.prototype.Bo=function(t){var e=bc();if(!fc.yt(e))throw new wr(br.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Au(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new fc(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(tl),nl=function(){function t(){}return t.prototype.initialize=function(t,e){return yr(this,void 0,void 0,(function(){var n=this;return vr(this,(function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Dh(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=qh.bind(null,this.syncEngine),[4,$c(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.createEventManager=function(t){return new sh},t.prototype.createDatastore=function(t){var e,n=Ic(t.databaseInfo.databaseId),r=(e=t.databaseInfo,new gc(e));return function(t,e,n){return new Ac(t,e,n)}(t.credentials,r,n)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return Dh(s.syncEngine,t,0)},o=yc.yt()?new yc:new pc,new Nc(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new Ih(t,e,n,r,i,o);return s&&(a.Oo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return yr(this,void 0,void 0,(function(){var e;return vr(this,(function(n){switch(n.label){case 0:return e=Cr(t),_r("RemoteStore","RemoteStore shutting down."),e.$r.add(5),[4,kc(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}}))}))}(this.remoteStore)},t}();var rl=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),il=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new fa,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then((function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))}),(function(t){return n.metadata.reject(t)}))}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return yr(this,void 0,void 0,(function(){return vr(this,(function(t){return[2,this.metadata.promise]}))}))},t.prototype.Lo=function(){return yr(this,void 0,void 0,(function(){return vr(this,(function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}}))}))},t.prototype.Ho=function(){return yr(this,void 0,void 0,(function(){var t,e,n,r;return vr(this,(function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new dh(JSON.parse(r),t.length+n)]}}))}))},t.prototype.Zo=function(){return this.buffer.findIndex((function(t){return t==="{".charCodeAt(0)}))},t.prototype.Jo=function(){return yr(this,void 0,void 0,(function(){var t,e;return vr(this,(function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}}))}))},t.prototype.Xo=function(t){return yr(this,void 0,void 0,(function(){var e;return vr(this,(function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}}))}))},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return yr(this,void 0,void 0,(function(){var t,e;return vr(this,(function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}}))}))}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return yr(this,void 0,void 0,(function(){var e,n=this;return vr(this,(function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new wr(br.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return yr(this,void 0,void 0,(function(){var n,r,i,o,s,a;return vr(this,(function(u){switch(u.label){case 0:return n=Cr(t),r=_s(n.R)+"/documents",i={documents:e.map((function(t){return bs(n.R,t)}))},[4,n.Oi("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){Nr(!!e.found),e.found.name,e.found.updateTime;var n=ws(t,e.found.name),r=vs(e.found.updateTime),i=new vi({mapValue:{fields:e.found.fields}});return gi.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){Nr(!!e.missing),Nr(!!e.readTime);var n=ws(t,e.missing),r=vs(e.readTime);return gi.newNoDocument(n,r)}(t,e):Dr()}(n.R,t);s.set(e.key.toString(),e)})),a=[],[2,(e.forEach((function(t){var e=s.get(t.toString());Nr(!!e),a.push(e)})),a)]}}))}))}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach((function(t){return n.recordVersion(t)})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new Lo(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return yr(this,void 0,void 0,(function(){var t,e=this;return vr(this,(function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=ni.fromPath(n);e.mutations.push(new Mo(r,e.precondition(r)))})),[4,function(t,e){return yr(this,void 0,void 0,(function(){var n,r,i;return vr(this,(function(o){switch(o.label){case 0:return n=Cr(t),r=_s(n.R)+"/documents",i={writes:e.map((function(t){return Ds(n.R,t)}))},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}}))}))}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}}))}))},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Dr();e=Mr.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new wr(br.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?wo.updateTime(e):wo.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Mr.min()))throw new wr(br.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return wo.updateTime(e)}return wo.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),ol=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new Tc(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji((function(){return yr(t,void 0,void 0,(function(){var t,e,n=this;return vr(this,(function(r){return t=new il(this.datastore),(e=this.sc(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.ic(t)}))}))})).catch((function(t){n.ic(t)})),[2]}))}))}))},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!Zr(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget((function(){return e.nc(),Promise.resolve()}))):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Vo(e)}return!1},t}(),sl=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=rc.UNAUTHENTICATED,this.clientId=xr.u(),this.credentialListener=function(){},this.receivedInitialUser=new fa,this.credentials.setChangeListener((function(t){_r("FirestoreClient","Received user=",t.uid),r.user=t,r.credentialListener(t),r.receivedInitialUser.resolve()}))}return t.prototype.getConfiguration=function(){return yr(this,void 0,void 0,(function(){return vr(this,(function(t){switch(t.label){case 0:return[4,this.receivedInitialUser.promise];case 1:return[2,(t.sent(),{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100})]}}))}))},t.prototype.setCredentialChangeListener=function(t){var e=this;this.credentialListener=t,this.receivedInitialUser.promise.then((function(){return e.credentialListener(e.user)}))},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new wr(br.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new fa;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((function(){return yr(t,void 0,void 0,(function(){var t,n;return vr(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=eh(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}}))}))})),e.promise},t}();function al(t,e){return yr(this,void 0,void 0,(function(){var n,r,i=this;return vr(this,(function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),_r("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener((function(n){r.isEqual(n)||(r=n,t.asyncQueue.enqueueRetryable((function(){return yr(i,void 0,void 0,(function(){return vr(this,(function(t){switch(t.label){case 0:return[4,Ou(e.localStore,n)];case 1:return t.sent(),[2]}}))}))})))})),e.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=e,[2]}}))}))}function ul(t,e){return yr(this,void 0,void 0,(function(){var n,r;return vr(this,(function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,cl(t)];case 1:return n=i.sent(),_r("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener((function(n){return t.asyncQueue.enqueueRetryable((function(){return function(t,e){return yr(this,void 0,void 0,(function(){var n,r;return vr(this,(function(i){switch(i.label){case 0:return(n=Cr(t)).asyncQueue.verifyOperationInProgress(),_r("RemoteStore","RemoteStore received new credentials"),r=Fc(n),n.$r.add(3),[4,kc(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.$r.delete(3),[4,Cc(n)];case 3:return i.sent(),[2]}}))}))}(e.remoteStore,n)}))})),t.onlineComponents=e,[2]}}))}))}function cl(t){return yr(this,void 0,void 0,(function(){return vr(this,(function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(_r("FirestoreClient","Using default OfflineComponentProvider"),[4,al(t,new Zh)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}}))}))}function hl(t){return yr(this,void 0,void 0,(function(){return vr(this,(function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(_r("FirestoreClient","Using default OnlineComponentProvider"),[4,ul(t,new nl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}}))}))}function ll(t){return cl(t).then((function(t){return t.persistence}))}function fl(t){return cl(t).then((function(t){return t.localStore}))}function dl(t){return hl(t).then((function(t){return t.remoteStore}))}function pl(t){return hl(t).then((function(t){return t.syncEngine}))}function yl(t){return yr(this,void 0,void 0,(function(){var e,n;return vr(this,(function(r){switch(r.label){case 0:return[4,hl(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=Th.bind(null,e.syncEngine),n.onUnlisten=Eh.bind(null,e.syncEngine),n)]}}))}))}function vl(t,e,n){var r=this;void 0===n&&(n={});var i=new fa;return t.asyncQueue.enqueueAndForget((function(){return yr(r,void 0,void 0,(function(){var r;return vr(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new rl({next:function(o){e.enqueueAndForget((function(){return uh(t,s)}));var a=o.docs.has(n);!a&&o.fromCache?i.reject(new wr(br.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new wr(br.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new fh(Bi(n.path),o,{includeMetadataChanges:!0,so:!0});return ah(t,s)},[4,yl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}function ml(t,e,n){var r=this;void 0===n&&(n={});var i=new fa;return t.asyncQueue.enqueueAndForget((function(){return yr(r,void 0,void 0,(function(){var r;return vr(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new rl({next:function(n){e.enqueueAndForget((function(){return uh(t,s)})),n.fromCache&&"server"===r.source?i.reject(new wr(br.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new fh(n,o,{includeMetadataChanges:!0,so:!0});return ah(t,s)},[4,yl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}var gl=function(t,e,n,r,i,o,s){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s},bl=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),wl=new Map,Il=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},Tl=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){this.changeListener=t,t(rc.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),_l=function(){function t(t){var e=this;this.oc=null,this.currentUser=rc.UNAUTHENTICATED,this.receivedInitialUser=!1,this.cc=0,this.changeListener=null,this.forceRefresh=!1,this.oc=function(){e.cc++,e.currentUser=e.uc(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.cc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.oc):(this.oc(null),t.get().then((function(t){e.auth=t,e.oc&&e.auth.addAuthTokenListener(e.oc)}),(function(){})))}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.cc!==e?(_r("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Nr("string"==typeof n.accessToken),new Il(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.oc),this.oc=null,this.changeListener=null},t.prototype.uc=function(){var t=this.auth&&this.auth.getUid();return Nr(null===t||"string"==typeof t),new rc(t)},t}(),El=function(){function t(t,e,n){this.ac=t,this.hc=e,this.lc=n,this.type="FirstParty",this.user=rc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.hc},e=this.ac.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.lc&&(t["X-Goog-Iam-Authorization-Token"]=this.lc),t},enumerable:!1,configurable:!0}),t}(),Sl=function(){function t(t,e,n){this.ac=t,this.hc=e,this.lc=n}return t.prototype.getToken=function(){return Promise.resolve(new El(this.ac,this.hc,this.lc))},t.prototype.setChangeListener=function(t){t(rc.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function Al(t,e,n){if(!n)throw new wr(br.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Dl(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new wr(br.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Nl(t,e,n,r){if(!0===e&&!0===r)throw new wr(br.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Cl(t){if(!ni.isDocumentKey(t))throw new wr(br.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function kl(t){if(ni.isDocumentKey(t))throw new wr(br.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function xl(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Dr()}function Rl(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new wr(br.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=xl(t);throw new wr(br.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function Ol(t,e){if(e<=0)throw new wr(br.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Pl=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new wr(br.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new wr(br.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,Nl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),Ll=function(){function t(t,e){this._persistenceKey="(lite)",this._settings=new Pl({}),this._settingsFrozen=!1,t instanceof bl?(this._databaseId=t,this._credentials=new Tl):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new wr(br.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new bl(t.options.projectId)}(t),this._credentials=new _l(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new wr(br.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new wr(br.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Pl(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Tl;switch(t.type){case"gapi":var e=t.client;return Nr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Sl(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new wr(br.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return this,(t=wl.get(this))&&(_r("ComponentProvider","Removing Datastore"),wl.delete(this),t.terminate()),Promise.resolve();var t},t}(),Ml=function(){function t(t,e,n){this._converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Vl(this.firestore,this._converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),Fl=function(){function t(t,e,n){this._converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),Vl=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,Bi(r))||this).firestore=e,i._path=r,i.type="collection",i}return pr(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Ml(this.firestore,null,new ni(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(Fl);function Ul(t,e){for(var n,r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];if(t=(0,i.m9)(t),Al("collection","path",e),t instanceof Ll)return kl(n=Br.fromString.apply(Br,mr([e],r))),new Vl(t,null,n);if(!(t instanceof Ml||t instanceof Vl))throw new wr(br.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return kl(n=Br.fromString.apply(Br,mr([t.path],r)).child(Br.fromString(e))),new Vl(t.firestore,null,n)}function ql(t,e){for(var n,r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];if(t=(0,i.m9)(t),1===arguments.length&&(e=xr.u()),Al("doc","path",e),t instanceof Ll)return Cl(n=Br.fromString.apply(Br,mr([e],r))),new Ml(t,null,new ni(n));if(!(t instanceof Ml||t instanceof Vl))throw new wr(br.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Cl(n=t._path.child(Br.fromString.apply(Br,mr([e],r)))),new Ml(t.firestore,t instanceof Vl?t._converter:null,new ni(n))}function Bl(t,e){return t=(0,i.m9)(t),e=(0,i.m9)(e),(t instanceof Ml||t instanceof Vl)&&(e instanceof Ml||e instanceof Vl)&&t.firestore===e.firestore&&t.path===e.path&&t._converter===e._converter}function jl(t,e){return t=(0,i.m9)(t),e=(0,i.m9)(e),t instanceof Fl&&e instanceof Fl&&t.firestore===e.firestore&&Xi(t._query,e._query)&&t._converter===e._converter}var Kl=function(){function t(){var t=this;this.fc=Promise.resolve(),this.dc=[],this.wc=!1,this._c=[],this.mc=null,this.yc=!1,this.gc=[],this.Zi=new Tc(this,"async_queue_retry"),this.Ec=function(){var e=wc();e&&_r("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=wc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ec)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this.wc},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Tc(),this.Ic(t)},t.prototype.enterRestrictedMode=function(){if(!this.wc){this.wc=!0;var t=wc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ec)}},t.prototype.enqueue=function(t){return this.Tc(),this.wc?new Promise((function(t){})):this.Ic(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget((function(){return e.dc.push(t),e.Ac()}))},t.prototype.Ac=function(){return yr(this,void 0,void 0,(function(){var t,e=this;return vr(this,(function(n){switch(n.label){case 0:if(0===this.dc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.dc[0]()];case 2:return n.sent(),this.dc.shift(),this.Zi.reset(),[3,4];case 3:if(!ga(t=n.sent()))throw t;return _r("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.dc.length>0&&this.Zi.ji((function(){return e.Ac()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Ic=function(t){var e=this,n=this.fc.then((function(){return e.yc=!0,t().catch((function(t){throw e.mc=t,e.yc=!1,Er("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.yc=!1,t}))}));return this.fc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Tc(),this.gc.indexOf(t)>-1&&(e=0);var i=th.createAndSchedule(this,t,e,n,(function(t){return r.Rc(t)}));return this._c.push(i),i},t.prototype.Tc=function(){this.mc&&Dr()},t.prototype.verifyOperationInProgress=function(){},t.prototype.bc=function(){return yr(this,void 0,void 0,(function(){var t;return vr(this,(function(e){switch(e.label){case 0:return[4,t=this.fc];case 1:e.sent(),e.label=2;case 2:if(t!==this.fc)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.vc=function(t){for(var e=0,n=this._c;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Pc=function(t){var e=this;return this.bc().then((function(){e._c.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e._c;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.bc()}))},t.prototype.Vc=function(t){this.gc.push(t)},t.prototype.Rc=function(t){var e=this._c.indexOf(t);this._c.splice(e,1)},t}();function Gl(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new fa,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var zl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._queue=new Kl,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return pr(e,t),e.prototype._terminate=function(){return this._firestoreClient||Hl(this),this._firestoreClient.terminate()},e}(Ll);function Ql(t){return t._firestoreClient||Hl(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Hl(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new gl(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new sl(t._credentials,t._queue,r)}function Wl(t,e,n){var r=this,i=new fa;return t.asyncQueue.enqueue((function(){return yr(r,void 0,void 0,(function(){var r;return vr(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,al(t,n)];case 1:return o.sent(),[4,ul(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===br.FAILED_PRECONDITION||t.code===br.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}}))}))})).then((function(){return i.promise}))}function Yl(t){if(t._initialized||t._terminated)throw new wr(br.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Xl=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new wr(br.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Kr(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),$l=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(zr.fromBase64String(e))}catch(e){throw new wr(br.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(zr.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),Jl=function(t){this._methodName=t},Zl=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new wr(br.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new wr(br.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return Rr(this._lat,t._lat)||Rr(this._long,t._long)},t}(),tf=/^__.*__$/,ef=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new Co(t,this.data,this.fieldMask,e,this.fieldTransforms):new No(t,this.data,e,this.fieldTransforms)},t}(),nf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new Co(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function rf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Dr()}}var of=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Sc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dc",{get:function(){return this.settings.Dc},enumerable:!1,configurable:!0}),t.prototype.Cc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.Nc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Cc({path:n,xc:!1});return r.Fc(t),r},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Cc({path:n,xc:!1});return r.Sc(),r},t.prototype.Oc=function(t){return this.Cc({path:void 0,xc:!0})},t.prototype.$c=function(t){return Sf(t,this.settings.methodName,this.settings.Mc||!1,this.path,this.settings.Lc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},t.prototype.Sc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Fc(this.path.get(t))},t.prototype.Fc=function(t){if(0===t.length)throw this.$c("Document fields must not be empty");if(rf(this.Dc)&&tf.test(t))throw this.$c('Document fields cannot begin and end with "__"')},t}(),sf=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Ic(t)}return t.prototype.Bc=function(t,e,n,r){return void 0===r&&(r=!1),new of({Dc:t,methodName:e,Lc:n,path:Kr.emptyPath(),xc:!1,Mc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function af(t){var e=t._freezeSettings(),n=Ic(t._databaseId);return new sf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function uf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Bc(o.merge||o.mergeFields?2:0,e,n,i);If("Data must be an object, but it was:",s,r);var a,u,c=bf(r,s);if(o.merge)a=new Gr(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=Tf(e,f[l],n);if(!s.contains(d))throw new wr(br.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");Af(h,d)||h.push(d)}a=new Gr(h),u=s.fieldTransforms.filter((function(t){return a.covers(t.field)}))}else a=null,u=s.fieldTransforms;return new ef(new vi(c),a,u)}var cf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return pr(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Dc)throw 1===t.Dc?t.$c(this._methodName+"() can only appear at the top level of your update data"):t.$c(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(Jl);function hf(t,e,n){return new of({Dc:3,Lc:e.settings.Lc,methodName:t._methodName,xc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var lf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return pr(e,t),e.prototype._toFieldTransform=function(t){return new go(t.path,new co)},e.prototype.isEqual=function(t){return t instanceof e},e}(Jl),ff=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).qc=n,r}return pr(e,t),e.prototype._toFieldTransform=function(t){var e=hf(this,t,!0),n=this.qc.map((function(t){return gf(t,e)})),r=new ho(n);return new go(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Jl),df=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).qc=n,r}return pr(e,t),e.prototype._toFieldTransform=function(t){var e=hf(this,t,!0),n=this.qc.map((function(t){return gf(t,e)})),r=new fo(n);return new go(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Jl),pf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return pr(e,t),e.prototype._toFieldTransform=function(t){var e=new yo(t.R,io(t.R,this.Uc));return new go(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(Jl);function yf(t,e,n,r){var o=t.Bc(1,e,n);If("Data must be an object, but it was:",o,r);var s=[],a=vi.empty();Vr(r,(function(t,r){var u=Ef(e,t,n);r=(0,i.m9)(r);var c=o.kc(u);if(r instanceof cf)s.push(u);else{var h=gf(r,c);null!=h&&(s.push(u),a.set(u,h))}}));var u=new Gr(s);return new nf(a,u,o.fieldTransforms)}function vf(t,e,n,r,o,s){var a=t.Bc(1,e,n),u=[Tf(e,r,n)],c=[o];if(s.length%2!=0)throw new wr(br.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var h=0;h<s.length;h+=2)u.push(Tf(e,s[h])),c.push(s[h+1]);for(var l=[],f=vi.empty(),d=u.length-1;d>=0;--d)if(!Af(l,u[d])){var p=u[d],y=c[d];y=(0,i.m9)(y);var v=a.kc(p);if(y instanceof cf)l.push(p);else{var m=gf(y,v);null!=m&&(l.push(p),f.set(p,m))}}var g=new Gr(l);return new nf(f,g,a.fieldTransforms)}function mf(t,e,n,r){return void 0===r&&(r=!1),gf(n,t.Bc(r?4:3,e))}function gf(t,e){if(wf(t=(0,i.m9)(t)))return If("Unsupported field value:",e,t),bf(t,e);if(t instanceof Jl)return function(t,e){if(!rf(e.Dc))throw e.$c(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.$c(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xc&&4!==e.Dc)throw e.$c("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=gf(o[i],e.Oc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,i.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return io(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Lr.fromDate(t);return{timestampValue:ds(e.R,n)}}if(t instanceof Lr)return n=new Lr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:ds(e.R,n)};if(t instanceof Zl)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof $l)return{bytesValue:ps(e.R,t._byteString)};if(t instanceof Ml){n=e.databaseId;var r=t.firestore._databaseId;if(!r.isEqual(n))throw e.$c("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:ms(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.$c("Unsupported field value: "+xl(t))}(t,e)}function bf(t,e){var n={};return Ur(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Vr(t,(function(t,r){var i=gf(r,e.Nc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function wf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Lr||t instanceof Zl||t instanceof $l||t instanceof Ml||t instanceof Jl)}function If(t,e,n){if(!wf(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=xl(n);throw"an object"===r?e.$c(t+" a custom object"):e.$c(t+" "+r)}}function Tf(t,e,n){if((e=(0,i.m9)(e))instanceof Xl)return e._internalPath;if("string"==typeof e)return Ef(t,e);throw Sf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var _f=new RegExp("[~\\*/\\[\\]]");function Ef(t,e,n){if(e.search(_f)>=0)throw Sf("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(Xl.bind.apply(Xl,mr([void 0],e.split(".")))))._internalPath}catch(T){throw Sf("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function Sf(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new wr(br.INVALID_ARGUMENT,(a+=". ")+t+u)}function Af(t,e){return t.some((function(t){return t.isEqual(e)}))}var Df=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Ml(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new Nf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.toProto())}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(Cf("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),Nf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return pr(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(Df);function Cf(t,e){return"string"==typeof e?Ef(t,e):e instanceof Xl?e._internalPath:e._delegate._internalPath}var kf=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),xf=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return pr(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Rf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.toProto(),t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(Cf("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(Df),Rf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return pr(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(xf),Of=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new kf(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach((function(r){t.call(e,new Rf(n._firestore,n._userDataWriter,r.key,r,new kf(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query._converter))}))},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new wr(br.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map((function(e){var r=new Rf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new kf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query._converter);return e.doc,{type:"added",doc:r,oldIndex:-1,newIndex:n++}}))}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new Rf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new kf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query._converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Pf(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function Pf(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Dr()}}function Lf(t,e){return t instanceof xf&&e instanceof xf?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Of&&e instanceof Of&&t._firestore===e._firestore&&jl(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Mf(t){if(Ki(t)&&0===t.explicitOrderBy.length)throw new wr(br.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Ff=function(){};function Vf(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){t=i[r]._apply(t)}return t}var Uf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qc=e,i.Kc=n,i.jc=r,i.type="where",i}return pr(e,t),e.prototype._apply=function(t){var e=af(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new wr(br.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Qf(s,o);for(var u=[],c=0,h=s;c<h.length;c++){var l=h[c];u.push(zf(r,t,l))}a={arrayValue:{values:u}}}else a=zf(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Qf(s,o),a=mf(n,"where",s,"in"===o||"not-in"===o);var f=Ei.create(i,o,a);return function(t,e){if(e.g()){var n=zi(t);if(null!==n&&!n.isEqual(e.field))throw new wr(br.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Gi(t);null!==r&&Hf(t,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new wr(br.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new wr(br.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,f),f}(t._query,0,e,t.firestore._databaseId,this.Qc,this.Kc,this.jc);return new Fl(t.firestore,t._converter,function(t,e){var n=t.filters.concat([e]);return new Ui(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(Ff),qf=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Qc=e,r.Wc=n,r.type="orderBy",r}return pr(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new wr(br.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new wr(br.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Li(e,n);return function(t,e){if(null===Gi(t)){var n=zi(t);null!==n&&Hf(t,n,e.field)}}(t,r),r}(t._query,this.Qc,this.Wc);return new Fl(t.firestore,t._converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new Ui(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(Ff),Bf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Gc=n,i.zc=r,i}return pr(e,t),e.prototype._apply=function(t){return new Fl(t.firestore,t._converter,Yi(t._query,this.Gc,this.zc))},e}(Ff),jf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return pr(e,t),e.prototype._apply=function(t){var e=Gf(t,this.type,this.Hc,this.Jc);return new Fl(t.firestore,t._converter,function(t,e){return new Ui(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(Ff),Kf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return pr(e,t),e.prototype._apply=function(t){var e=Gf(t,this.type,this.Hc,this.Jc);return new Fl(t.firestore,t._converter,function(t,e){return new Ui(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(Ff);function Gf(t,e,n,r){if(n[0]=(0,i.m9)(n[0]),n[0]instanceof Df)return function(t,e,n,r,i){if(!r)throw new wr(br.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=Hi(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(hi(e,r.key));else{var c=r.data.field(u.field);if(Xr(c))throw new wr(br.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new wr(br.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new Oi(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var o=af(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new wr(br.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new wr(br.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Qi(t)&&-1!==c.indexOf("/"))throw new wr(br.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Br.fromString(c));if(!ni.isDocumentKey(h))throw new wr(br.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new ni(h);a.push(hi(e,l))}else{var f=mf(n,r,c);a.push(f)}}return new Oi(a,o)}(t._query,t.firestore._databaseId,o,e,n,r)}function zf(t,e,n){if("string"==typeof(n=(0,i.m9)(n))){if(""===n)throw new wr(br.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Qi(e)&&-1!==n.indexOf("/"))throw new wr(br.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Br.fromString(n));if(!ni.isDocumentKey(r))throw new wr(br.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return hi(t,new ni(r))}if(n instanceof Ml)return hi(t,n._key);throw new wr(br.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+xl(n)+".")}function Qf(t,e){if(!Array.isArray(t)||0===t.length)throw new wr(br.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new wr(br.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Hf(t,e,n){if(!n.isEqual(e))throw new wr(br.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var Wf=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),ri(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Wr(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Yr(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Dr()}},t.prototype.convertObject=function(t,e){var n=this,r={};return Vr(t.fields||{},(function(t,i){r[t]=n.convertValue(i,e)})),r},t.prototype.convertGeoPoint=function(t){return new Zl(Wr(t.latitude),Wr(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.convertValue(t,e)}))},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=$r(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Jr(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=Hr(t);return new Lr(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=Br.fromString(t);Nr(js(n));var r=new bl(n.get(1),n.get(3)),i=new ni(n.popFirst(5));return r.isEqual(e)||Er("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function Yf(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Xf=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return pr(e,t),e.prototype.convertBytes=function(t){return new $l(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Ml(this.firestore,null,e)},e}(Wf),$f=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=af(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=Jf(t,this._firestore),i=Yf(r._converter,e,n),o=uf(this._dataReader,"WriteBatch.set",r._key,i,null!==r._converter,n);return this._mutations.push(o.toMutation(r._key,wo.none())),this},t.prototype.update=function(t,e,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];this._verifyNotCommitted();var s,a=Jf(t,this._firestore);return s="string"==typeof(e=(0,i.m9)(e))||e instanceof Xl?vf(this._dataReader,"WriteBatch.update",a._key,e,n,r):yf(this._dataReader,"WriteBatch.update",a._key,e),this._mutations.push(s.toMutation(a._key,wo.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=Jf(t,this._firestore);return this._mutations=this._mutations.concat(new Lo(e._key,wo.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new wr(br.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function Jf(t,e){if((t=(0,i.m9)(t)).firestore!==e)throw new wr(br.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Zf=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return pr(e,t),e.prototype.convertBytes=function(t){return new $l(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Ml(this.firestore,null,e)},e}(Wf);function td(t,e,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];t=Rl(t,Ml);var s=Rl(t.firestore,zl),a=af(s);return nd(s,[("string"==typeof(e=(0,i.m9)(e))||e instanceof Xl?vf(a,"updateDoc",t._key,e,n,r):yf(a,"updateDoc",t._key,e)).toMutation(t._key,wo.exists(!0))])}function ed(t){for(var e,n,r,o=[],s=1;s<arguments.length;s++)o[s-1]=arguments[s];t=(0,i.m9)(t);var a={includeMetadataChanges:!1},u=0;"object"!=typeof o[u]||Gl(o[u])||(a=o[u],u++);var c,h,l,f={includeMetadataChanges:a.includeMetadataChanges};if(Gl(o[u])){var d=o[u];o[u]=null===(e=d.next)||void 0===e?void 0:e.bind(d),o[u+1]=null===(n=d.error)||void 0===n?void 0:n.bind(d),o[u+2]=null===(r=d.complete)||void 0===r?void 0:r.bind(d)}if(t instanceof Ml)h=Rl(t.firestore,zl),l=Bi(t._key.path),c={next:function(e){o[u]&&o[u](rd(h,t,e))},error:o[u+1],complete:o[u+2]};else{var p=Rl(t,Fl);h=Rl(p.firestore,zl),l=p._query;var y=new Zf(h);c={next:function(t){o[u]&&o[u](new Of(h,y,p,t))},error:o[u+1],complete:o[u+2]},Mf(t._query)}return function(t,e,n,r){var i=this,o=new rl(r),s=new fh(e,o,n);return t.asyncQueue.enqueueAndForget((function(){return yr(i,void 0,void 0,(function(){var e;return vr(this,(function(n){switch(n.label){case 0:return e=ah,[4,yl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}}))}))})),function(){o.Wo(),t.asyncQueue.enqueueAndForget((function(){return yr(i,void 0,void 0,(function(){var e;return vr(this,(function(n){switch(n.label){case 0:return e=uh,[4,yl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}}))}))}))}}(Ql(h),l,f,c)}function nd(t,e){return function(t,e){var n=this,r=new fa;return t.asyncQueue.enqueueAndForget((function(){return yr(n,void 0,void 0,(function(){var n;return vr(this,(function(i){switch(i.label){case 0:return n=Sh,[4,pl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(Ql(t),e)}function rd(t,e,n){var r=n.docs.get(e._key),i=new Zf(t);return new xf(t,i,e._key,r,new kf(n.hasPendingWrites,n.fromCache),e._converter)}var id=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return pr(e,t),e.prototype.get=function(e){var n=this,r=Jf(e,this._firestore),i=new Zf(this._firestore);return t.prototype.get.call(this,e).then((function(t){return new xf(n._firestore,i,r._key,t._document,new kf(!1,!1),r._converter)}))},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=af(t)}return t.prototype.get=function(t){var e=this,n=Jf(t,this._firestore),r=new Xf(this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return Dr();var i=t[0];if(i.isFoundDocument())return new Df(e._firestore,r,i.key,i,n._converter);if(i.isNoDocument())return new Df(e._firestore,r,n._key,null,n._converter);throw Dr()}))},t.prototype.set=function(t,e,n){var r=Jf(t,this._firestore),i=Yf(r._converter,e,n),o=uf(this._dataReader,"Transaction.set",r._key,i,null!==r._converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];var s,a=Jf(t,this._firestore);return s="string"==typeof(e=(0,i.m9)(e))||e instanceof Xl?vf(this._dataReader,"Transaction.update",a._key,e,n,r):yf(this._dataReader,"Transaction.update",a._key,e),this._transaction.update(a._key,s),this},t.prototype.delete=function(t){var e=Jf(t,this._firestore);return this._transaction.delete(e._key),this},t}());function od(){if("undefined"==typeof Uint8Array)throw new wr(br.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function sd(){if("undefined"==typeof atob)throw new wr(br.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var ad=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return sd(),new t($l.fromBase64String(e))},t.fromUint8Array=function(e){return od(),new t($l.fromUint8Array(e))},t.prototype.toBase64=function(){return sd(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return od(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),ud=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Yl(t=Rl(t,zl));var n=Ql(t),r=t._freezeSettings(),i=new nl;return Wl(n,i,new tl(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Yl(t=Rl(t,zl));var e=Ql(t),n=t._freezeSettings(),r=new nl;return Wl(e,r,new el(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new wr(br.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new fa;return t._queue.enqueueAndForgetEvenWhileRestricted((function(){return yr(e,void 0,void 0,(function(){var e;return vr(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return yr(this,void 0,void 0,(function(){var e;return vr(this,(function(n){switch(n.label){case 0:return ya.yt()?(e=t+"main",[4,ya.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(Au(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t._delegate)},t}(),cd=function(){function t(t,e,n){var r=this;this._delegate=e,this.Yc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof bl||(this.Xc=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._delegate._getSettings()),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e){!function(t,e,n){var r=(t=Rl(t,Ll))._getSettings();"firestore.googleapis.com"!==r.host&&r.host!==e&&Sr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},r),{host:e+":"+n,ssl:!1}))}(this._delegate,t,e)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return yr(e,void 0,void 0,(function(){var e,n;return vr(this,(function(r){switch(r.label){case 0:return[4,ll(t)];case 1:return e=r.sent(),[4,dl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=Cr(t);return e.$r.delete(0),Cc(e)}(n))]}}))}))}))}(Ql(Rl(this._delegate,zl)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return yr(e,void 0,void 0,(function(){var e,n;return vr(this,(function(r){switch(r.label){case 0:return[4,ll(t)];case 1:return e=r.sent(),[4,dl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return yr(this,void 0,void 0,(function(){var e;return vr(this,(function(n){switch(n.label){case 0:return(e=Cr(t)).$r.add(0),[4,kc(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(Ql(Rl(this._delegate,zl)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Nl("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Yc.enableMultiTabIndexedDbPersistence(this):this.Yc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Yc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.Xc&&(this.Xc._removeServiceInstance("firestore"),this.Xc._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new fa;return t.asyncQueue.enqueueAndForget((function(){return yr(e,void 0,void 0,(function(){var e;return vr(this,(function(r){switch(r.label){case 0:return e=xh,[4,pl(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(Ql(Rl(this._delegate,zl)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new rl(e);return t.asyncQueue.enqueueAndForget((function(){return yr(n,void 0,void 0,(function(){var e;return vr(this,(function(n){switch(n.label){case 0:return e=function(t,e){Cr(t).Gr.add(e),e.next()},[4,yl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))})),function(){r.Wo(),t.asyncQueue.enqueueAndForget((function(){return yr(n,void 0,void 0,(function(){var e;return vr(this,(function(n){switch(n.label){case 0:return e=function(t,e){Cr(t).Gr.delete(e)},[4,yl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))}))}}(Ql(t=Rl(t,zl)),Gl(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.Xc)throw new wr(br.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Xc},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new _d(this,Ul(this._delegate,t))}catch(t){throw yd(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new pd(this,ql(this._delegate,t))}catch(t){throw yd(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new wd(this,function(t,e){if(t=Rl(t,Ll),Al("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new wr(br.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Fl(t,null,function(t){return new Ui(Br.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw yd(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new fa;return t.asyncQueue.enqueueAndForget((function(){return yr(n,void 0,void 0,(function(){var n;return vr(this,(function(i){switch(i.label){case 0:return[4,function(t){return hl(t).then((function(t){return t.datastore}))}(t)];case 1:return n=i.sent(),new ol(t.asyncQueue,n,e,r).run(),[2]}}))}))})),r.promise}(Ql(t),(function(n){return e(new id(t,n))}))}(this._delegate,(function(n){return t(new ld(e,n))}))},t.prototype.batch=function(){var t=this;return Ql(this._delegate),new fd(new $f(this._delegate,(function(e){return nd(t._delegate,e)})))},t.prototype.loadBundle=function(t){throw new wr(br.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new wr(br.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),hd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return pr(e,t),e.prototype.convertBytes=function(t){return new ad(new $l(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return pd.Zc(e,this.firestore,null)},e}(Wf);var ld=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new hd(t)}return t.prototype.get=function(t){var e=this,n=Ed(t);return this._delegate.get(n).then((function(t){return new gd(e._firestore,new xf(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n._converter))}))},t.prototype.set=function(t,e,n){var r=Ed(t);return n?(Dl("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Ed(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,mr([s,e,n],i)),this},t.prototype.delete=function(t){var e=Ed(t);return this._delegate.delete(e),this},t}(),fd=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=Ed(t);return n?(Dl("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Ed(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,mr([s,e,n],i)),this},t.prototype.delete=function(t){var e=Ed(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),dd=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new Rf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new bd(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.tu=function(e,n){var r=t.eu,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new hd(e),n),i.set(n,o)),o},t}();dd.eu=new WeakMap;var pd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new hd(t)}return t.nu=function(e,n,r){if(e.length%2!=0)throw new wr(br.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new Ml(n._delegate,r,new ni(e)))},t.Zc=function(e,n,r){return new t(n,new Ml(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new _d(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new _d(this.firestore,Ul(this._delegate,t))}catch(t){throw yd(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=(0,i.m9)(t))instanceof Ml&&Bl(this._delegate,t)},t.prototype.set=function(t,e){e=Dl("DocumentReference.set",e);try{return function(t,e,n){t=Rl(t,Ml);var r=Rl(t.firestore,zl),i=Yf(t._converter,e,n);return nd(r,[uf(af(r),"setDoc",t._key,i,null!==t._converter,n).toMutation(t._key,wo.none())])}(this._delegate,t,e)}catch(t){throw yd(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?td(this._delegate,t):td.apply(void 0,mr([this._delegate,t,e],n))}catch(t){throw yd(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return nd(Rl((t=this._delegate).firestore,zl),[new Lo(t._key,wo.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=vd(e),i=md(e,(function(e){return new gd(t.firestore,new xf(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate._converter))}));return ed(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Rl(t,Ml);var e=Rl(t.firestore,zl),n=Ql(e),r=new Zf(e);return function(t,e){var n=this,r=new fa;return t.asyncQueue.enqueueAndForget((function(){return yr(n,void 0,void 0,(function(){var n;return vr(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return yr(this,void 0,void 0,(function(){var r,i;return vr(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=Cr(t);return n.persistence.runTransaction("read document","readonly",(function(t){return n.Mn.mn(t,e)}))}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new wr(br.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=eh(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}}))}))},[4,fl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._key).then((function(n){return new xf(e,r,t._key,n,new kf(null!==n&&n.hasLocalMutations,!0),t._converter)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Rl(t,Ml);var e=Rl(t.firestore,zl);return vl(Ql(e),t._key,{source:"server"}).then((function(n){return rd(e,t,n)}))}(this._delegate):function(t){t=Rl(t,Ml);var e=Rl(t.firestore,zl);return vl(Ql(e),t._key).then((function(n){return rd(e,t,n)}))}(this._delegate)).then((function(t){return new gd(e.firestore,new xf(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate._converter))}))},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(dd.tu(this.firestore,e)):this._delegate.withConverter(null))},t}();function yd(t,e,n){return t.message=t.message.replace(e,n),t}function vd(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!Gl(r))return r}return{}}function md(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=Gl(t[0])?t[0]:Gl(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var gd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new pd(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return Lf(this._delegate,t._delegate)},t}(),bd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return pr(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(gd),wd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new hd(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Vf(this._delegate,function(t,e,n){var r=e,i=Cf("where",t);return new Uf(i,r,n)}(e,n,r)))}catch(e){throw yd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Vf(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=Cf("orderBy",t);return new qf(r,n)}(e,n)))}catch(e){throw yd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,Vf(this._delegate,function(t){return Ol("limit",t),new Bf("limit",t,"F")}(e)))}catch(e){throw yd(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Vf(this._delegate,function(t){return Ol("limitToLast",t),new Bf("limitToLast",t,"L")}(e)))}catch(e){throw yd(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Vf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new jf("startAt",t,!0)}.apply(void 0,e)))}catch(e){throw yd(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Vf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new jf("startAfter",t,!1)}.apply(void 0,e)))}catch(e){throw yd(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Vf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Kf("endBefore",t,!0)}.apply(void 0,e)))}catch(e){throw yd(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Vf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Kf("endAt",t,!1)}.apply(void 0,e)))}catch(e){throw yd(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return jl(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Rl(t,Fl);var e=Rl(t.firestore,zl),n=Ql(e),r=new Zf(e);return function(t,e){var n=this,r=new fa;return t.asyncQueue.enqueueAndForget((function(){return yr(n,void 0,void 0,(function(){var n;return vr(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return yr(this,void 0,void 0,(function(){var r,i,o,s,a;return vr(this,(function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,Bu(t,e,!0)];case 1:return a=u.sent(),r=new gh(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=eh(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}}))}))},[4,fl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._query).then((function(n){return new Of(e,r,t,n)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Rl(t,Fl);var e=Rl(t.firestore,zl),n=Ql(e),r=new Zf(e);return ml(n,t._query,{source:"server"}).then((function(n){return new Of(e,r,t,n)}))}(this._delegate):function(t){t=Rl(t,Fl);var e=Rl(t.firestore,zl),n=Ql(e),r=new Zf(e);return Mf(t._query),ml(n,t._query).then((function(n){return new Of(e,r,t,n)}))}(this._delegate)).then((function(t){return new Td(e.firestore,new Of(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}))},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=vd(e),i=md(e,(function(e){return new Td(t.firestore,new Of(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))}));return ed(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(dd.tu(this.firestore,e)):this._delegate.withConverter(null))},t}(),Id=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new bd(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),Td=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new wd(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map((function(e){return new bd(t._firestore,e)}))},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map((function(t){return new Id(e._firestore,t)}))},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach((function(r){t.call(e,new bd(n._firestore,r))}))},t.prototype.isEqual=function(t){return Lf(this._delegate,t._delegate)},t}(),_d=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return pr(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new pd(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new pd(this.firestore,void 0===t?ql(this._delegate):ql(this._delegate,t))}catch(t){throw yd(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=Rl(t.firestore,zl),r=ql(t),i=Yf(t._converter,e);return nd(n,[uf(af(t.firestore),"addDoc",r._key,i,null!==t._converter,{}).toMutation(r._key,wo.exists(!1))]).then((function(){return r}))}(this._delegate,t).then((function(t){return new pd(e.firestore,t)}))},e.prototype.isEqual=function(t){return Bl(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,t?this._delegate.withConverter(dd.tu(this.firestore,t)):this._delegate.withConverter(null))},e}(wd);function Ed(t){return Rl(t,Ml)}var Sd=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(Xl.bind.apply(Xl,mr([void 0],t)))}return t.documentId=function(){return new t(Kr.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=(0,i.m9)(t))instanceof Xl&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),Ad=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new lf("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new cf("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ff("arrayUnion",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new df("arrayRemove",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new pf("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}();var Dd,Nd=n(1181),Cd={Firestore:cd,GeoPoint:Zl,Timestamp:Lr,Blob:ad,Transaction:ld,WriteBatch:fd,DocumentReference:pd,DocumentSnapshot:gd,Query:wd,QueryDocumentSnapshot:bd,QuerySnapshot:Td,CollectionReference:_d,FieldPath:Sd,FieldValue:Ad,setLogLevel:function(t){var e;e=t,Ir.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new Nd.wA("firestore",(function(t){return function(t,e){return new cd(t,new zl(t,e),new ud)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},Cd)))})(Dd=r.Z),Dd.registerVersion("@firebase/firestore","2.2.3")}}]);
//# sourceMappingURL=firestore.998f9e83.chunk.js.map